<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ptNL Study</title>
    <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script> -->
    <script src="../jspsych-6.1.0/jspsych.js"></script>
    <!-- <script src="../jspsych-6.1.0/plugins/jspsych-instructions-delay.js"></script> -->
    <script src="../jspsych-6.1.0/plugins/jspsych-instructions-gray2.js"></script>
    <script src="../jspsych-6.1.0/plugins/jspsych-html-keyboard-response.js"></script>
    <script src="../jspsych-6.1.0/plugins/jspsych-image-keyboard-response.js"></script>
    <script src="../jspsych-6.1.0/plugins/jspsych-html-button-response.js"></script>
    <script src="../jspsych-6.1.0/plugins/jspsych-html-button-responseHTML.js"></script>
    <script src="../jspsych-6.1.0/plugins/jspsych-html-slider-response.js"></script>
    <script src="../jspsych-6.1.0/plugins/jspsych-survey-html-form.js"></script>
    <script src="../jspsych-6.1.0/plugins/jspsych-survey-html-timer.js"></script>
    <script src="../jspsych-6.1.0/plugins/jspsych-fullscreen-ptNL.js"></script>
    <script src="../jspsych-6.1.0/plugins/jspsych-call-function.js"></script>
    <script src="../jspsych-6.1.0/plugins/jspsych-survey-multi-choice.js"></script>
    <script src="../jspsych-6.1.0/plugins/jspsych-reconstruction-btnloc.js"></script>
    <!--<script src="../jspsych-6.1.0/plugins/jspsych-reconstruction.js"></script>-->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/svg.js/2.6.3/svg.min.js"></script>
    <script src="../jspsych-6.1.0/plugins/jspsych-virtual-chinrest_kw.js"></script>

    <!-- <script src="../jspsych-6.1.0/plugins/jo-show-maze-trace-resp.js"></script> -->
    <script src="../jspsych-6.1.0/plugins/kw-show-click2.js"></script>
    <script src="../jspsych-6.1.0/plugins/jspsych-rdk.js"></script>
    <script src="../jspsych-6.1.0/plugins/rw-html-slider-response.js"></script>
    <script src="../jspsych-6.1.0/plugins/jspsych-survey-text.js"></script>
    <script src="../jspsych-6.1.0/plugins/jspsych-virtual-chinrest_kw.js"></script>


    <!-- jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"
      integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU=" crossorigin="anonymous"></script>

    <!-- <link href = "../jspsych-6.1.0/css/jspsych-cpCD.css" rel="stylesheet" type="text/css"></link> -->
    <link href = "../jspsych-6.1.0/css/jspsych-ptNL_nodynfont.css" rel="stylesheet" type="text/css"></link>
</head>
<body>
    <script>

    // 02.20.2023 - took ullObs code and adapted it for pt study
    // 02.22.2023 - combining both Huichao instructions section with click module.
    // 03.13.2023 - Mental Number Line version created.
    // 04.02.2023 - add Virtual chinrest (var virtualChin).

    /*
    ===============================================================
    Table of Contents (*TOC)
    ===============================================================
    1. Core Variables (*coreV) -- bypass, constants, blanks
    2. Introduction Section (*timelineintro)
    3. Experiment Section (*timelineexpt)
    4. JSPsych Init, and onFinish (*initexpt)
    5. Critical functions (*fx)
    6. Code for each trial (*singleTrial)


    */

    /*
    ===============================================================
    Defining Core Variables (*coreV)
    ===============================================================
    */

    var stimFolder = 'stimuli/'

    var runIntro = true;
    var runInstr = true;
    var runExpt = true;
    var runDebrief = true;
    var runSaveData = true;

    var runVirtualChinrest = true;
    var skipToTask = false;
    if (skipToTask == true){
        runIntro = false
        runInstr = false
    }
    // var probeType = 'letter'
    var probeType = 'gabor'

    var imgWidth = 1000*0.75
    var imgHeight = 740*0.75
    // var grayDims =

    var fixationWidth = 50
    var letterWidth = 50
    var gaborWidth = 200
    var horizontalRadius = 250
    var bg_width = 800
    var bg_height = 300

    var LETTER_PROBE_DURATION = 150
    var GABOR_PROBE_DURATION = 300
    var ISI_DURATION = 500


    var estTotalRunTime = 3
    var estDollars = 0.45

    var timelinebase = [];
    var forPreload = [];
    var full_check = false;

    //participant information extraction from URL
    var participantType = 'prolific'; // either 'mturk' or 'pOrolific'
    // var participantType = 'mturk';
    // var participantType = 'sona'
    var prolific_url = 'https://app.prolific.co/submissions/complete?cc=2D8B06CB';

    var w = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
    var h = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;
    console.log(w,h)
    var leftdistance = w/2-75;
    var text_color = 'black';

    var RADIUS = 250
    var HRADW = RADIUS*Math.cos(0.785398)
    var HRADH = RADIUS*Math.sin(0.785398)



    // capture URL query info (capture query)
    var code = jsPsych.randomization.randomID(10);

    if (participantType == 'mturk'){
        var participantID;
        var workerID = getURLParameter('workerId');
        var hitID = getURLParameter('hitId');
        var assignmentID = getURLParameter('assignmentId');
        console.log(workerID, hitID, assignmentID);
    } else if (participantType == 'prolific'){
        var participantID;
        var workerID = getURLParameter('PROLIFIC_PID');
        var hitID = getURLParameter('STUDY_ID');
        var assignmentID = getURLParameter('SESSION_ID');
        console.log(workerID, hitID, assignmentID);
    } else if (participantType == 'sona'){
        var participantID;
        var workerID = getURLParameter('sona_id');
        var hitID = getURLParameter('testing_hitID');
        var assignmentID = getURLParameter('testing_assignmentID');
    } else {
        var participantID = 'testing_pID';
        var workerID = 'testingworker_ID';
        var hitID = 'testing_hitID';
        var assignmentID = 'testing_assignmentID';
    };



    /*
    ===============================================================
    INTRO PROCEDURE (*timelineintro)
    ===============================================================
    */

    /*-------------- Relevant intro variables (*introVar/*varIntro)---------------------*/
    var welcome = {
        type: 'html-button-response',
        stimulus: "<div style='font-size: 2.6vh; display: inline-block; margin: auto; padding: 10px 200px 10px 200px; text-align: left'>"+
        '<p>Welcome to the experiment.</p><p>Please make sure you are completing the experiment on a COMPUTER OR LAPTOP. '+
        'You will <b>not</b> be able to complete this experiment on a phone or tablet. </p>'+'</div>',
        choices: ['Next'],
        on_finish: function(){
            if (/Mobi|Android/i.test(navigator.userAgent)) {
                console.log("Uh Oh, this is a mobile device");
                jsPsych.endExperiment("Oh no! It appears you're on a mobile/tablet device. Please try again on a computer or laptop.")
            }else{
                console.log("Good, not a mobile device.")
            }

            // console.log(w*2,h*2)
        },
        data: {trial_category: 'welcome',
                screenWidth: String(w),
                screenHeight: String(h),
                // radius: String(RADIUS),
                clock: function(){
                var startTime = new Date().toLocaleString("en-US", {timeZone: "America/New_York"});
                startTime = new Date(startTime);
                console.log('Start Time'+startTime.toLocaleString())
                return startTime
            }
        }
    };

    // consent form
    var consent = {
        type: 'html-keyboard-response',
        choices: ['y'],
        stimulus: consentForm(participantType),
        prompt: "<h3>PRESS THE Y KEY TO CONSENT</h3><p></p><p></p>",
        data: {trial_category: 'consent'}
    };


    var id = {
        type: 'survey-html-form',
        html: function(){
            var text = "<div style='font-size: 2.6vh; display: inline-block; margin: auto; padding: 10px 200px 10px 200px; text-align: left'>"
            if (participantType == 'sona'){
                var insert = "SONA Portal ID (not your Yale ID) -- this should be a 5 digit number with no letters"
            } else {
                var insert = participantType + " ID"
            }
            if (workerID == 'no_query'){
                text +="<p>Please provide your "+insert+":</p><br><input required='true' name='numberID' type='text' size='100' />"
                // text +="<p>Please provide your "+participantType+" ID:</p><br><input required='true' name='numberID' type='text' size='100' />"
            } else if (workerID != undefined){
                console.log(workerID)
                text +="<p>Please provide your "+insert+":</p><br><input required='true' name='numberID' type='text' size='100' />"
                // text +="<p>Please provide your "+participantType+" ID:</p><br><input required='true' name='numberID' type='text' value="+String(workerID)+" size='100' />"
            } else {
                console.log("code is not working")
                text +="<p>Please provide your "+insert+":</p><br><input required='true' name='numberID' type='text' size='100' />"
                // text +="<p>Please provide your "+participantType+" ID:</p><br><input required='true' name='numberID' type='text' size='100' />"
            }
            text +="<p>(Note: Depending on the way you accessed this link, you may find that your ID is already  entered into the box for your convenience, but please double check if this number is correct before proceeding.)</p>"
            text +="</div>"

            return text},
        data: {trial_category: 'id_info'},
        on_finish: function(data) {
            var respObj = JSON.parse(data.responses);
            for (var key in respObj) {
                if (respObj[key] == participantID){
                    console.log("The manual type matches the query capture, going with query input.");
                } else if (participantID = 'no_query'){
                    console.log("The Query was not successfully captured, going with manual input.");
                    participantID = respObj[key];
                } else {
                    console.log("The manual type differed from the query capture, going with query capture.")
                }
            }  /*end of for loop*/
        } /*end of on_finish*/
    };

    var survey = {
        type: 'html-keyboard-response',
        stimulus: surveyForm(),
        choices: ['y'],
        data: {trial_category: 'survey'}
    }

    /* ------- timeline intro push (*pushIntro) -------------- */

    if (runIntro == true){
        timelinebase.push(welcome);
        timelinebase.push(consent);
        timelinebase.push(id);
        timelinebase.push({type: 'fullscreen',
                            fullscreen_mode: true,
                            on_finish: function(){
                                full_check = true;
                            }
                        });
        // timelinebase.push(survey);
    }/* if runIntro == true end */



    /*
    ===============================================================
    INSTR PROCEDURE (*timelineinstr)
    ===============================================================
    */

    var instrContent = loadInstrContent();

    if (runInstr == true){
        for (var slide = 0; slide < instrContent.length; slide++){
            var instruction_delay = {
                type: 'instructions',
                pages: [instrContent[slide]],
                allow_keys: false,
                allow_backward: false,
                show_clickable_nav: true,
                button_delay: 2000,
                data: {trial_category: 'instruction'}
            }

            timelinebase.push(instruction_delay)

        } /* for loop ends*/
    }/* if runInstr true end*/


    /*
    ===============================================================
    EXPERIMENT PROCEDURE (*timelineexpt)
    ===============================================================
    */

    /* -------- defining factors && exptdesign (*factors) --------*/
    var possAgent = ["t","f"];
    var possTableNum = [16,91];
    var possProbePos = ["L","R"]

    var possRotate = [0];
    var possFlip = ['n'];
    var possProbe = [0,1,2];
    var possLetterType = ['p','b'];
    var possGaborType = [110, 70];

    if (probeType == 'gabor'){
        var possProbeType = possGaborType
    } else if (probetype == 'letter'){
        var possProbeType = possLetterType
    }


    var factors = {
        agent: possAgent,
        tableNum: possTableNum,
        probePos: possProbePos,
    }

    var full_design = jsPsych.randomization.factorial(factors, 1);

    for (var i = 0; i < possAgent.length; i++){
        for (var j = 0; j < possTableNum.length; j++){
            forPreload.push(stimFolder+possAgent[i]+String(possTableNum[j])+".png");
        }
    }

    for (var j = 0; j < possProbe.length; j++){
        forPreload.push(stimFolder+"probe"+String(possProbe[i])+".png")
    }

    for (var k = 0; k < possLetterType.length; k++){
        forPreload.push(stimFolder+"letter_"+possLetterType[k]+".png")
    }

    for (var i = 0; i < possGaborType.length; i++){
        forPreload.push(stimFolder+"gabor"+String(possGaborType[i])+".png")
    }


    forPreload.push(stimFolder+"demo500.png");
    forPreload.push(stimFolder+"suitcase.png");
    forPreload.push(stimFolder+"coffeeMug.png");
    forPreload.push(stimFolder+"fixation.png");
    forPreload.push(stimFolder+"logoY.png");
    forPreload.push(stimFolder+"logoS.png");
    forPreload.push(stimFolder+"cardIntro2.png");



    /* ------- timeline expt push (*pushExpt ) -------------- */
    if (runExpt == true){
        // for (var elem = 0; elem < full_design.length; elem++){ /* normally its elem < 1 for single trial */
        for (var elem = 0; elem < 1; elem++){ /* normally its elem < 1 for single trial */

            var thisRotate = jsPsych.randomization.sampleWithReplacement(possRotate, 1)[0];
            var thisFlip = jsPsych.randomization.sampleWithReplacement(possFlip, 1) [0];
            var thisProbeType = jsPsych.randomization.sampleWithoutReplacement(possProbeType, 1)[0];
            runSingleTrial(full_design[elem].agent, full_design[elem].tableNum, full_design[elem].probePos, thisProbeType, timelinebase, 'expt');

        }


    }


    /*
    ===============================================================
    CLOSING SECTION (*timelineclose)
    ===============================================================
    */

    // var debrief_qs = {
    //     type: 'survey-html-form',
    //     html: debriefForm(),
    //     data: {trial_category: 'debrief',
    //         clock: function(){
    //             var endTime = new Date().toLocaleString("en-US", {timeZone: "America/New_York"});
    //             endTime = new Date(endTime);
    //             console.log('End Time'+endTime.toLocaleString())
    //             return endTime
    //         }
    //     },
    //     on_finish: function(){
    //         var postdeb= jsPsych.data.get().filterCustom(function(trial){
    //             return trial.trial_category != "answer_instr";
    //         })
    //         // jsPsych.data.displayData('csv');
    //         var answerfiltered1 = jsPsych.data.get().filter({trial_category: "answer"})
    //         // console.log(answerfiltered.csv());
    //
    //         saveData(participantID+"postdeb_data", postdeb.csv())
    //         saveData(participantID+"answerfiltered1_data", answerfiltered1.csv());
    //     }
    // };


    var debrief_original = {
        type: 'survey-html-form',
        html: debriefForm(),
        data: {trial_category: 'debrief_original'}
    }


    var debrief_rememberAny = {
        type: 'survey-html-form',
        preamble: "<div style='width: 70%; font-size: 2.4vh; text-align: left; margin: auto'>" + "</p>Now let us try to remember something different. Earlier, we asked you to click on 3 white triangles. But there were a lot of other white things on the black table besides the triangles. In 1-2 sentences, please tell us anything you remember about what they were.</p>",
        html: '<p><input style ="height:200px" type="text" required="true" id="debrief_rememberAny" name="debrief_rememberAny" size="100" /></p>',
        autofocus: 'debrief_rememberAny',
        // data: {trial_category:"anchor_watch"}
        data: {trial_category:"debrief_rememberAny"}
    }

    var debrief_confidence = {
        type: 'survey-html-form',
        html: debriefForm_confidence(),
        data: {trial_category: 'debrief_confidence',
            clock: function(){
                var endTime = new Date().toLocaleString("en-US", {timeZone: "America/New_York"});
                endTime = new Date(endTime);
                console.log('End Time'+endTime.toLocaleString())
                return endTime
            }
        },
        on_start: function () {
                    document.body.style.backgroundColor = 'white';
                    document.body.style.textColor = 'black';
                    document.body.style.overflow = 'scroll';
                },
        on_finish: function(){
            var full= jsPsych.data.get().filterCustom(function(trial){
                return trial.trial_category != "answer_instr";
            })
            // jsPsych.data.displayData('csv');
            var answerfiltered = jsPsych.data.get().filter({trial_category: "answer"})
            var taskfiltered = jsPsych.data.get().filter({trial_category: "task", thispShow: "all"})
            // console.log(answerfiltered.csv());

            if (runSaveData == true){
                saveData(participantID+"answerfiltered_data", answerfiltered.csv());
                saveData(participantID+"full_data", full.csv())
                saveData(participantID+"taskfiltered_data", taskfiltered.csv());

                var rand_code = hitID+String(code)+participantID;
                var saveRandCode = {
                    'savetocsv': 'workerCreditCodes', //filename to save the data with
                    'curData': participantID+','+hitID+','+assignmentID+','+rand_code// data to save
                    }
                myPostData('mySave.php', saveRandCode);
            } /*if runSaveData end*/
        }
    };

    // var closing = {
    //     type: 'html-keyboard-response',
    //     stimulus: closingText(participantType),
    //     choices: ['Spacebar'],
    //     data: {trial_category: 'closing'},
    //     on_start: function(){
    //         if (participantType == 'mturk'){
    //             jsPsych.endExperiment()
    //         } else if (participantType == 'prolific'){
    //             console.log("this is a prolific participant")
    //         }
    //     }, /* end of closing on start function */
    //     on_finish: function(){
    //         if (participantType == 'prolific'){
    //             window.open(prolific_url, '_blank')
    //         }
    //         jsPsych.endExperiment()
    //     }
    // };


    // new closing module
    var closing = {
        type: 'html-keyboard-response',
        stimulus: closingText(participantType),
        choices: ['Spacebar'],
        data: {trial_category: 'closing'},
        on_start: function(){
            if (participantType == 'mturk'){
                jsPsych.endExperiment()
            } else if (participantType == 'prolific'){
                console.log("this is a prolific participant")
            } else if (participantType == 'sona'){
                console.log("this is a sona")
            }
        },
        on_finish: function(){
            if (participantType == 'prolific'){
                window.open(prolific_url, '_blank')
            }
            jsPsych.endExperiment()
        } /* end of closing on finish function */
    };

    /* ------- timeline close push (*pushclose) -------------- */

    if (runDebrief == true) {
        timelinebase.push(debrief_original);
        timelinebase.push(debrief_rememberAny);
        timelinebase.push(debrief_confidence);
    }
    timelinebase.push({type: 'fullscreen', fullscreen_mode: false});
    timelinebase.push(closing);


    // four unique sets, four cloths per set, randomly shuffle position, two possible difftrial conditions

    /*
    ===============================================================
    JSPsych Init, and onFinish (*initexpt)
    ===============================================================
    */
    jsPsych.init({
        preload_images: forPreload,
        on_interaction_data_update: function(){
            var interaction_data = jsPsych.data.getInteractionData().last(1).values()[0].event;
            if (interaction_data == 'fullscreenexit'){
                console.log("Fullscreen Exit detected")
                full_check = false
            } else if (interaction_data == 'fullscreenenter') {
                console.log("Fullscreen problem now solved")
                full_check = true
            }
        },
        // on_trial_finish: function(data){
        //     if (data.trial_category == 'answer'){
        //         if (data.button_pressed == 0 && data.leftID == 'target'){
        //             data.thisAcc = 1;
        //         } else if (data.button_pressed == 1 && data.rightID == 'target'){
        //             data.thisAcc = 1;
        //         } else if (data.button_pressed == 0 && data.leftID == 'distractor'){
        //             data.thisAcc = 0;
        //         } else if (data.button_pressed == 1 && data.rightID =='distractor'){
        //             data.thisAcc = 0;
        //         } else {
        //             data.thisAcc = "KimYourCodeIsBroken"
        //         }
        //
        //     } /*if answer end*/
        // }, /*on trial finish end*/
        on_finish: function() {
            var full = jsPsych.data.get().filterCustom(function(trial){
                return trial.trial_category != "answer_instr";
            })
            // jsPsych.data.displayData('csv');
            var answerfiltered = jsPsych.data.get().filter({trial_category: "answer"})
            // console.log(answerfiltered.csv());

            if (runSaveData == true){
                saveData(participantID+"answerfiltered_data", answerfiltered.csv());
                saveData(participantID+"full_data", full.csv())

                var rand_code = hitID+String(code)+participantID;
                var saveRandCode = {
                    'savetocsv': 'workerCreditCodes', //filename to save the data with
                    'curData': participantID+','+hitID+','+assignmentID+','+rand_code// data to save
                    }
                myPostData('mySave.php', saveRandCode);
            }
        },
        timeline: timelinebase,
    })


    /*
    ===============================================================
    CRITICAL FUNCTIONS (*fx)
    ===============================================================
    */


    /* ----------------------------------------
     Functions for text: instructions, debrief, consent, and id form entry (*fxtext)
    -------------------------------------------*/
    function loadInstrContent() {
        var instrContent = [
            /* ind0 */'<p>Hello! Thank you for volunteering to help out with our study. Please take a moment to adjust your seating so that you can comfortably watch the monitor and use the keyboard. Feel free to dim the lights as well.</p><p>Close the door or do whatever is necessary to <b>minimize disturbance during the experiment</b>. Please also take a moment to silence your phone so that you are not interrupted by any messages mid-experiment. Do <i>not</i> switch to any other tabs or windows until you are complete.</p><p>From here on out, you will notice the arrow to continue to the next page is initially grayed out, unable to be pressed. Just wait a short while and then you will be able to proceed.</p>',
            /* ind1 */'<p>Before the formal experiments begin, we need to know the screen resolution and your sitting distance. </p> <p>To do so, please prepare a credit card or other item of the same size (for example, a driver license or a membership card). You will be asked to put the card on the screen and resize an image until it is the same size as the card. </p>'+
            '<p>Don‘t worry, we cannot access the information on your card. You will only need to put your card like the following so you can adjust the image size on the screen based on the card size. (Scroll down to the bottom of the page to proceed)</p>'+
            '<div style="text-align: center;"><img src="'+stimFolder+'cardIntro2.png"  height= 400px / ></div>'
        ]
        for (var i = 0; i < instrContent.length; i++){
            instrContent[i] = "<div style='font-size: 2.6vh; display: inline-block; margin: auto; padding: 10px 200px 10px 200px; text-align: left'>"+instrContent[i]+"</div>"
        }
        return instrContent
    }


    function consentForm(participantType){
        if (participantType == 'sona'){
            var consentContent = "<h5>USE ARROW KEYS TO SCROLL DOWN, AND PRESS 'Y' TO CONSENT.<br>In order to run this study, we need to include the standard consent form below.</h5><h1>Consent for Participation in a Research Study</h1><div style='width: 100%; text-align: center'><div style='display: inline-block; margin: auto; padding: 10px 200px 10px 200px; text-align: left'><h5>STUDY TITLE</h5><p>Testing reaction time and your judgement abilities</p>"+
            "<h5>RESEARCH STUDY SUMMARY, RISKS, AND BENEFITS</h5><p>Thank you for volunteering to participate in this research study. The purpose of this study is to better understand how we see and how we think. Study activities will include examining simple displays and then responding by answering questions, pressing some keys, or using a computer mouse. Because these are activities that many people already experience hundreds or thousands of times every day, there are no risks involved in this study. The study may have no benefits to you, but it may help the scientific community come to better understand how the human mind works. Taking part in this study is your choice. You can choose to take part, or you can choose not to take part in this study. You can also change your mind at any time, with no penalty.</p><h5>DURATION</h5><p>If you agree to take part, the study will last approximately <strong> "+String(estTotalRunTime)+" minutes</strong>.</p>"+
            "<h5>COSTS AND COMPENSATION</h5><p>There are no costs associated with participation in this study. You will receive <strong>"+String(0.5)+" credits</strong> for participating.</p><h5>CONFIDENTIALITY</h5><p>No personally identifying information will be collected, so your participation will be anonymous. The survey is anonymous. We will not know your name. We will not be able to connect any identifying information to your survey answers. However, we will know your mTurk number in order to pay you for your time. We will keep the information about your participation in this research confidential. Your data will be pooled with those from other participants, and may be included in scientific publications and uploaded to public data repositories.</p>"+
            "<h5>LEARNING MORE</h5><p>If you have questions about this study, you may contact your experimenters Kimberly Wong at kimberly.wong@yale.edu or Huichao Ji at huichao.ji@yale.edu. If you have questions about your rights as a research participant, or you have complaints about this research, you can contact the Yale Institutional Review Boards at 203-785-4688 or hrpp@yale.edu.</p><h5>INFORMED CONSENT</h5><p>Your participation indicates that you have read and understood this consent form and the information presented and that you agree to be in this study.</p></div></div>"
        } else {
            var consentContent = "<h5>USE ARROW KEYS TO SCROLL DOWN, AND PRESS 'Y' TO CONSENT.<br>In order to run this study, we need to include the standard consent form below.</h5><h1>Consent for Participation in a Research Study</h1><div style='width: 100%; text-align: center'><div style='display: inline-block; margin: auto; padding: 10px 200px 10px 200px; text-align: left'><h5>STUDY TITLE</h5><p>Testing reaction time and your judgement abilities</p>"+
            "<h5>RESEARCH STUDY SUMMARY, RISKS, AND BENEFITS</h5><p>Thank you for volunteering to participate in this research study. The purpose of this study is to better understand how we see and how we think. Study activities will include examining simple displays and then responding by answering questions, pressing some keys, or using a computer mouse. Because these are activities that many people already experience hundreds or thousands of times every day, there are no risks involved in this study. The study may have no benefits to you, but it may help the scientific community come to better understand how the human mind works. Taking part in this study is your choice. You can choose to take part, or you can choose not to take part in this study. You can also change your mind at any time, with no penalty.</p><h5>DURATION</h5><p>If you agree to take part, the study will last approximately <strong> "+String(estTotalRunTime)+" minutes</strong>.</p>"+
            "<h5>COSTS AND COMPENSATION</h5><p>There are no costs associated with participation in this study. You will receive <strong>"+String(estDollars)+" dollars</strong> for participating.</p><h5>CONFIDENTIALITY</h5><p>No personally identifying information will be collected, so your participation will be anonymous. The survey is anonymous. We will not know your name. We will not be able to connect any identifying information to your survey answers. However, (if you are accessing this experiment through mTurk), we will know your mTurk number in order to pay you for your time. Your mTurk number could possibly be connected to your public profile, which could, in theory, be searched. We want to stress that we will not be looking at anyone's public profiles. We will keep the information about your participation in this research confidential. Your data will be pooled with those from other participants, and may be included in scientific publications and uploaded to public data repositories.</p>"+
            "<h5>LEARNING MORE</h5><p>If you have questions about this study, you may contact your experimenters Kimberly Wong at kimberly.wong@yale.edu or Huichao Ji at huichao.ji@yale.edu. If you have questions about your rights as a research participant, or you have complaints about this research, you can contact the Yale Institutional Review Boards at 203-785-4688 or hrpp@yale.edu.</p><h5>INFORMED CONSENT</h5><p>Your participation indicates that you have read and understood this consent form and the information presented and that you agree to be in this study.</p></div></div>"
        }

        consentContent = "<div style='font-size: 2.6vh;'>"+consentContent+"</div>"

        return consentContent
    }

    function surveyForm(){
        var surveyContent =
            "<div style='width: 100%; text-align: center'><div style='display: inline-block; margin: auto; padding: 10px 200px 10px 200px; text-align: left'>"+
            "<p>We wanted to provide a heads-up that the end of the experiment will consist of an anonymous survey with multiple questions. "+
            "A few questions are open-ended questions where you need to type 1-2 sentences. Sometimes participants do not like answering open-ended questions and tend to quit a survey once they see such questions. "+
            "If a sizable number of people quit a survey halfway, the responses will no longer be useful. Our research depends on good quality responses. Thus, please make sure you do not mind open-ended questions before continuing with experiment.</p>"+
            "<p><i>Press 'y' on your keyboard if you agree to answer the open-ended questions at the end of the experiment.</i><br>"+
            "</div>"
        return surveyContent
    }

    function debriefForm(){
        var debriefContent = "<div style='width: 70%; text-align: left; margin: auto'>" +
        '<p>Great work. Finally, we just have a couple of questions for you!<br>' +
        '<p>Age: <br><input required="true" name="age" type="number" style="width: 20%; border-radius: 4px; padding: 10px 10px; margin: auto; border: 1px solid #ccc; font-size: 18px"/>' +
        '<p>Please indicate your biological sex:<br><input required="true" type="radio" id="male" name="gender" value="male"><label for="male">Male</label><br><input required="true" type="radio" id="female" name="gender" value="female"><label for="female">Female</label><br><input required="true" type="radio" id="other" name="gender" value="other"><label for="other">Other</label><br><input required="true" type="radio" id="no_say" name="gender" value="no_say"><label for="no_say">I prefer not to say</label>' +
        '<p>Anything else to share (did any of the images get cut off on your screen, text too small, or just additional thoughts, etc.)? <br><input required="true" name="6_final" type="text" size="50" style="width: 100%; border-radius: 4px; padding: 10px 10px; margin: auto; border: 1px solid #ccc; font-size: 18px"/></p>' +
        '<p>Can you tell us what device(s) you used to complete the study (e.g. a laptop, a desktop computer, a laptop hooked up to a second monitor, etc?)<br><input required="true" name="7_monitorsetup" type="text" size="50" style="width: 100%; border-radius: 4px; padding: 10px 10px; margin: 8px 0; border: 1px solid #ccc; font-size: 18px"/></p>'
            // '<p>We know it is generally difficult to stay focused in these online experiments, especially when they take this long.  On a scale of 1-100 (with 1 being very distracted, and 100 being very focused), how well did you pay attention to the experiment?  (Whatever you respond with will NOT affect whether you receive credit or compensation). <br><input required="true" name="6_attention" type="number" max="100" style="width: 20%; border-radius: 4px; padding: 10px 10px; margin: 8px 0; border: 1px solid #ccc; font-size: 15px"></p>' +
        // '<p>Please reenter your ID once more:<br><input required="true" name="id_code" type="text" style="width: 20%; border-radius: 4px; padding: 10px 10px; margin: 8px 0; border: 1px solid #ccc; font-size: 15px"/>' +
        // '<p>Worker ID Code:<br><input required="true" name="id_code" type="text" style="width: 20%; border-radius: 4px; padding: 10px 10px; margin: 8px 0; border: 1px solid #ccc; font-size: 15px"/>' +
        "</div>"
        return debriefContent
    };

    function letter_1(){
        var letter_1 = "<div style='width: 60%; text-align: left; margin: auto'>" +
        '<p>Actually, just now, there is a chance that something else appeared on screen while the red dot was present.  Half of the participants were not shown anything besides the red dot, but the other half of participants did have something additional flash on screen.<br>' +
        '<p>Do you think you were in the group that had something additional flash on screen or the group that only had the red dot? <br><input required="true" type="radio" id="yes" name="letter_1" value="yes"><label for="yes">I was in the group that was shown something additional besides the red dot.</label><br><input required="true" type="radio" id="no" name="letter_1" value="no"><label for="no">I was in the group that was only shown the red dot.</label>' +
        "</div>"
        return letter_1
    };


    function letter_2(){
        var letter_2 = "<div style='width: 60%; text-align: left; margin: auto'>" +
        '<p>You were actually in the group that saw something additional. In fact, it either the letter "b" or the letter "p". What letter did you see? Even if you do not know, just make your best guess. <br><input required="true" type="radio" id="b" name="letter_2" value="b"><label for="b">The letter "b"</label><br><input required="true" type="radio" id="p" name="letter_2" value="p"><label for="p">The letter "p"</label>' +
        "</div>"
        return letter_2
    };


    function debriefForm_confidence() {
        var debriefContent_confidence =
        "<div style='width: 50%; text-align: left; margin: auto'>" +
        '<p>In fact, when we asked you to click on the white triangles, there was also a number on the table. Do you remember what that number was? Type in your best guess, and even if you don’t remember, just guess.<br><input name="tableNumGuess" type="number" size="50" style="width: 100%; border-radius: 4px; padding: 10px 10px; margin: 8px 0; border: 1px solid #ccc; font-size: 18px" required>' +
        '<p>Using the slider below, on a scale of 1-100 (with 1 being not confident at all, and 100 being very confident), how confident are you about the number you just typed above?  (This will not affect whether you receive credit or compensation.) <br> <p style="text-align:left;">Not confident at all <span style="float:right;">Very Confident</span></p> <input type="range" value="50" min="1" max="100" name = "confidence" class="slider" style="width:100%" required oninput="this.nextElementSibling.value = this.value"> <output id = "confidence_out"  style="text-align:center">_</output> </p>' +
        "</div>"
        return debriefContent_confidence
    };
    function letter_confidence() {
        var Letter_confidence =
        "<div style='width: 50%; text-align: left; margin: auto'>" +
        '<p>Using the slider below, on a scale of 1-10 (with 1 being not confident at all, and 10 being very confident), how confident are you in the letter you reported seeing just now? (This will not affect whether you receive credit or compensation.) <br> <p style="text-align:left;">Not confident at all <span style="float:right;">Very Confident</span></p> <input type="range" value="4" min="1" max="10" name = "letter_confidence" class="slider" style="width:100%" required oninput="this.nextElementSibling.value = this.value"> <output id = "letter_confidence_out"  style="text-align:center">_</output> </p>' +
        "</div>"
        return Letter_confidence
    };
    function gabor_confidence() {
        var Gabor_confidence =
        "<div style='width: 50%; text-align: left; margin: auto'>" +
        '<p>Using the slider below, on a scale of 1-10 (with 1 being not confident at all, and 10 being very confident), how confident are you that you matched the original stripes that you were shown? (This will not affect whether you receive credit or compensation.) <br> <p style="text-align:left;">Not confident at all <span style="float:right;">Very Confident</span></p> <input type="range" value="4" min="1" max="10" name = "letter_confidence" class="slider" style="width:100%" required oninput="this.nextElementSibling.value = this.value"> <output id = "letter_confidence_out"  style="text-align:center">_</output> </p>' +
        "</div>"
        return Gabor_confidence
    };


    function closingText(participantType){
        var base = "Thank you so much for your contribution to science! The experiment has concluded. Please contact kimberly.wong@yale.edu or huichao.ji@yale.edu if you have any further questions.";
        var addition = "";
        if (participantType == 'mturk'){
            var rand_code = hitID+String(code)+participantID;
            var addition = "<p>Here is your <b>unique</b> code: "+rand_code+"</p><p>To recieve payment for this experiment, you must take this code back to the page that directed you here. Enter the code into the box there. If you encounter problems during this step, please contact the email above.";
        } else if (participantType == 'prolific'){
            var addition = "<p>For your convenience, you will find your completion code in a new tab <b>after you press the Spacebar</b>. Alternatively, here is the code for you to enter manually: <b>2D8B06CB</b>. If you encounter any problems during this step, please contact the email above."
        } else if (participantType == 'sona'){
            var addition = "<p>If you're interested in learning more about this experiment, please see the following google doc, and do not hesitate to reach out! Thank you for participating.</p><p>https://docs.google.com/document/d/1WxqXB8pD6Fv7XpP7IS3HsYDqlxJ-yT4M/edit?usp=sharing&ouid=109087269691106150998&rtpof=true&sd=true</p>"
        }
        return base+addition
    };


    /* ----------------------------------------
     Functions for datahandling and saving (*fxdata, *fxsave)
    -------------------------------------------*/

    function getURLParameter(sParam){
        var sPageURL = window.location.search.substring(1);
        var sURLVariables = sPageURL.split('&');
        for (var i = 0; i < sURLVariables.length; i++){
            var sParameterName = sURLVariables[i].split('=');
            if (sParameterName[0] == sParam){
                return sParameterName[1];
            }
        }
        console.log("The input was not found")
        return 'no_query'
    };

    function myPostData(page,data){
        $.ajax({
            type: "POST",
            url: page,
            data: data,
        });
    }

    function saveData(name, data){
        var xhr = new XMLHttpRequest();
        xhr.open('POST', 'write_data.php'); // 'write_data.php' is the path to the php file described above.
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.send(JSON.stringify({filename: name, filedata: data}));
    };



    /*
    ===============================================================
    PUSHING/RUNNING A CUSTOM SINGLE TRIAL (*singleTrial)
    ===============================================================
    */

    function runSingleTrial(agentType, numOnTable, probePos, thisProbeType, timelineTrialsToPush, trialType){
        // different trialType modifiers
        if (trialType == 'instr' || trialType == 'instr_nocross' || trialType == 'instr_nomask'){
            var append = '_instr'
            // var preobj = 'prac'
        } else if (trialType == 'prac' || trialType == 'stair'){
            var append = '_prac'
            // var preobj = 'prac'
        } else {
            var append = ''
            // var preobj = ''
        }

        var checkScreen = {
            type: "fullscreen",
            message: "<p>Unfortunately, it appears you have turned off fullscreen mode. Please make sure to remain in fullscreen mode. <br>Click on the button to fullscreen the experiment again and proceed.</p>",
            fullscreen_mode: true,
            button_label: "Resume",
        }

        var if_notFull = {
            timeline: [checkScreen],
            conditional_function: function(){
                if (full_check == false){
                    return true;
                } else {
                    return false
                }
            }
        }

        var cursor_off = {
            type: 'call-function',
            func: function() {
                document.body.style.cursor= "none";
            }
        }

        var cursor_on = {
            type: 'call-function',
            func: function() {
                document.body.style.cursor= "auto";
            }
        }


        var virtualChin = {
            type: 'virtual-chinrest-kw',
            blindspot_reps: 3,
            resize_units:"deg",
            pixels_per_unit: 25,
        }

        var mug_intro = {
            type: 'html-button-response',
            stimulus: "<div style= 'display: inline-block; margin: auto; padding: 10px 200px 10px 200px; text-align: left'>"+
            '<p>Good job! In the following extremely short experiment, you will be performing 4 different tasks.</p><p>In the first task (on the next page) you will see a picture of a colorful object flash on screen for less than a second. Your task is simple. Pay close attention to this image. Once it disappears, describe what you saw in as much detail as you can. </p><p>When you are ready, press the "Next" button to begin.</p>'+
            '</div>',
            choices: ['Next'],
        }

        var isi = {
            type: "html-keyboard-response",
            stimulus: "",
            choices: jsPsych.NO_KEYS,
            trial_duration: 800,
            data: {trial_category: "ISI"}
        }

        var mugImgShow = {
            type: "html-keyboard-response",
            stimulus: "<img src='"+stimFolder+"coffeeMug.png' height= 500px />",
            choices: jsPsych.NO_KEYS,
            trial_duration: 800,
            data: {trial_category: "mugImgShow"}
        }

        var mugTextResponse = {
            type: 'survey-html-form',
            preamble: '<p>In at least 1-2 sentences, describe what you saw just now in as much detail as you can.</p>',
            html: '<p><input type="text" required="true" id="mugTextResponse" name="mugTextResponse" size="50" /></p>',
            autofocus: 'mugTextResponse',
            // data: {trial_category:"anchor_watch"}
            data: {trial_category:"mugTextResponse"+append}
        }


        var logoTask = {
            type: "html-button-response2",
            stimulus: "Click on the logo that you would choose for this company that wants to appear 'organized and professional'.",
            choices: function(){
                var logoWidth = 400;
                var w = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
                if (logoWidth > ((w/2)-200) ){
                    console.log("TOO BIG")
                    var afcimgWidth = (w/2)-100
                } else {
                    var afcimgWidth = logoWidth
                }

                var stimContent = []
                stimContent.push("<img src='"+stimFolder+"logoY.png' width='"+String(afcimgWidth)+"' />");
                stimContent.push("<img src='"+stimFolder+"logoS.png' width='"+String(afcimgWidth)+"' />");
                return stimContent
            },
            data: {trial_category: "logoTask"+append} // data end
        } // logoTask

        // var promptContent = "<div style='position: absolute; left:"+String(30)+"px ; top:"+String(h*2+30)+"px' >'f' = no ; 'j' = yes</div>";
        // var promptContent = "<div>Can you get from the red to the blue?'<br><b>f</b>' = no ; '<b>j</b>' = yes</div>";
        var benchImgPath = stimFolder + agentType +String(numOnTable) + ".png"
        var probe0ImgPath = stimFolder + "probe0.png"
        var probe1ImgPath = stimFolder + "probe1.png"
        var probe2ImgPath = stimFolder + "probe2.png"

        var captcha = function(benchImgPath, agentType, numOnTable, left, top, imgWidth, imgHeight, probe0ImgPath, probe1ImgPath, probe2ImgPath){
            var clickResponse = {
                type: 'kw-show-click',
                image_path: benchImgPath,
                agentType: agentType,
                numOnTable: numOnTable,
                left: left,
                top: top,
                image_w: imgWidth,
                image_h: imgHeight,
                probe0_path: probe0ImgPath,
                probe1_path: probe1ImgPath,
                probe2_path: probe2ImgPath,
                scale_factor: function(){
                    var scale_factor = jsPsych.data.get().select('scale_factor').values[0];
                    return scale_factor
                },
                data: {trial_category: "clickResponse"+trialType}
            }
            return clickResponse
        }


        var transitiontask1 = {
            type: "html-keyboard-response",
            stimulus: "<div style='margin: auto; padding: 10px 200px 10px 200px;'><p>Great. On to task #2. On the next page, you will see two potential logos for a new company. Use your mouse and click on which logo you think would be best for the company, given that the company hopes to come across as 'very organized and professional'.</p><p>When you are ready, press the Spacebar to see the images.</p></div>",
            choices: ['Spacebar'],
            data: {trial_category: "transition"}
        }

        var transitiontask2 = {
            type: "html-keyboard-response",
            stimulus: "<div style='margin: auto; padding: 10px 200px 10px 200px;'><p>Good job! Now for task #3. On the next page, an image will appear on screen, and you should <b>click on all the white triangles</b> in the image. <p>When you are ready, press the Spacebar to begin.</p></div>",
            choices: ['Spacebar'],
            data: {trial_category: "transition"}
        }

        var transitiontask3 = {
            type: "html-keyboard-response",
            stimulus: "<div style='margin: auto; padding: 10px 200px 10px 200px;'><p>Good work. Finally, starting on the next page, you will see a circle in the middle of the screen. <b>Keep your eyes on the circle until it eventually disappears</b>, and you will be asked questions about it afterwards.</p><p>When you are ready, press the Spacebar to begin.</p></div>",
            choices: ['Spacebar'],
            data: {trial_category: "transition"}
        }

        //LETTER FLASHING SECTION HERE

        var fixation = {
            type: "html-keyboard-response",
            stimulus: function () {
                // console.log(jsPsych.data.get().values()[0]);
                // if (runVirtualChinrest == true) {
                //     // console.log(jsPsych.data.get().filter({trial_type: 'virtual-chinrest-kw'}))
                //     var win_width = jsPsych.data.get().select('win_width_deg').values[0];
                //     var px2deg = jsPsych.data.get().select('px2deg').values[0];
                //     var scale_factor = jsPsych.data.get().select('scale_factor').values[0];
                //     converted = (win_width*px2deg)
                //     console.log(converted, scale_factor)
                // } else {
                //     var scale_factor = 1
                // }
                if (probeType == 'gabor'){
                    var background = '<div style="display: block; position: static; top: '+String(0)+'px; left:'+String(0)+'px; background-color: #808080; width: '+String(bg_width)+'px; height: '+String(bg_height)+'px;" ></div>';
                } else {
                    var background = '';
                }
                var display = background + "<div style='position: absolute; left:" + String((bg_width/2)-(fixationWidth/2)) + "px ; top: "+ String((bg_height/2)-(fixationWidth/2)) +"px'>" + "<img src='" + stimFolder + "fixation.png' height='" + String(fixationWidth) + "' /> </div>"

                return display
                // return test
            },
            choices: jsPsych.NO_KEYS,
            trial_duration: 3000,
            data: {trial_category: "fixation" + append},
        }

        if (probeType == 'letter') {
            var showProbe = {
                type: "html-keyboard-response",
                stimulus: function () {
                    var whalf = window.innerWidth / 2 || document.documentElement.clientWidth / 2 || document.body.clientWidth / 2;
                    var hhalf = window.innerHeight / 2 || document.documentElement.clientHeight / 2 || document.body.clientHeight / 2;

                    var posL = [(whalf - (letterWidth / 2)) - horizontalRadius, (hhalf - (letterWidth / 2))];
                    var posR = [(whalf - (letterWidth / 2)) + horizontalRadius, (hhalf - (letterWidth / 2))];
                    var posF = [(whalf - (fixationWidth / 2)), (hhalf - (fixationWidth / 2))];

                    var display = "<div style='position: absolute; left:" + String(posF[0]) + "px ; top:" + String(posF[1]) + "px'>" + "<img src='" + stimFolder + "fixation.png' height='" + String(fixationWidth) + "' /> </div>"
                    if (probePos == "L") {
                        var usePos = posL
                    } else if (probePos == "R") {
                        var usePos = posR
                    }
                    display += "<div style='position: absolute; left:" + String(usePos[0]) + "px ; top:" + String(usePos[1]) + "px'>" + "<img src='" + stimFolder + "letter_" + thisProbeType + ".png' height='" + String(letterWidth) + "' /> </div>"
                    return display
                },
                choices: jsPsych.NO_KEYS,
                trial_duration: LETTER_PROBE_DURATION,
                data: {
                    trial_category: "letterFlash" + append,
                    agentType: agentType,
                    numOnTable: numOnTable,
                    thisProbeType: thisProbeType,
                    probePos: probePos,
                    numberlineConsistency: function () {
                        if (probePos == 'L' && numOnTable < 50) {
                            return 1
                        } else if (probePos = 'R' && numOnTable > 50) {
                            return 1
                        } else {
                            return 0
                        }
                    }, //numberlineConsistency end
                    letterWidth: letterWidth,
                    letterHeight: letterWidth,
                    fixationWidth: fixationWidth,
                }// data end
            } //showProbe end
        } else if (probeType == 'gabor'){
           var showProbe = {
                type: "html-keyboard-response",
                stimulus: function () {
                    var whalf = window.innerWidth / 2 || document.documentElement.clientWidth / 2 || document.body.clientWidth / 2;
                    var hhalf = window.innerHeight / 2 || document.documentElement.clientHeight / 2 || document.body.clientHeight / 2;

                    var posL = [((bg_width/2) - (gaborWidth / 2)) - horizontalRadius, ((bg_height/2) - (gaborWidth / 2))];
                    var posR = [((bg_width/2) - (gaborWidth / 2)) + horizontalRadius, ((bg_height/2) - (gaborWidth / 2))];

                    var background = '<div style="display: block; position: static; background-color: #808080; width: '+String(bg_width)+'px; height: '+String(bg_height)+'px;" ></div>';
                    var display = background + "<div style='position: absolute; left:" + String((bg_width/2)-(fixationWidth/2)) + "px ; top: "+ String((bg_height/2)-(fixationWidth/2)) +"px'>" + "<img src='" + stimFolder + "fixation.png' height='" + String(fixationWidth) + "' /> </div>"

                    // var display = "<div style='position: absolute; left:" + String(posF[0]) + "px ; top:" + String(posF[1]) + "px'>" + "<img src='" + stimFolder + "fixation.png' height='" + String(fixationWidth) + "' /> </div>"
                    if (probePos == "L") {
                        var usePos = posL
                    } else if (probePos == "R") {
                        var usePos = posR
                    }
                    display += "<div style='position: absolute; left:" + String(usePos[0]) + "px ; top:" + String(usePos[1]) + "px'>" + "<img src='" + stimFolder + "gabor" + String(thisProbeType) + ".png' height='" + String(gaborWidth) + "' /> </div>"
                    return display
                },
                choices: jsPsych.NO_KEYS,
                trial_duration: GABOR_PROBE_DURATION,
                data: {
                    trial_category: "letterFlash" + append,
                    agentType: agentType,
                    numOnTable: numOnTable,
                    thisProbeType: thisProbeType,
                    probePos: probePos,
                    numberlineConsistency: function () {
                        if (probePos == 'L' && numOnTable < 50) {
                            return 1
                        } else if (probePos = 'R' && numOnTable > 50) {
                            return 1
                        } else {
                            return 0
                        }
                    }, //numberlineConsistency end
                    probeWidth: gaborWidth,
                    probeHeight: gaborWidth,
                    fixationWidth: fixationWidth,
                },// data end
               // on_finish: function(){jsPsych.data.displayData('csv')}
            } //showProbe end
        } // end of if probeType

        var updateRotation = function(param){
            var whalf = window.innerWidth/2 || document.documentElement.clientWidth/2 || document.body.clientWidth/2;
            var hhalf = window.innerHeight/2 || document.documentElement.clientHeight/2 || document.body.clientHeight/2;
            var rot = 40 + Math.round(param * 100)
            console.log(rot);
            var html =
                '<div style="width: 800px; text-align: left; position:static;">' +
                '<p>You were actually in the group that saw something additional. In fact, it was a little set of stripes just like the one you see below. ' +
                'Even if you do not remember seeing the stripes, or if you\'re uncertain about what exactly you saw, I would like you to <b>try your best</b> '+
                'to recreate the exact diagonal stripes that were shown to you.</p>' +
                '<p>Press "g" to rotate the image <b>left</b>. <br>Press "h" to rotate the image <b>right</b>.</p>'+
                '<p>When you are done rotating the image to best match what you were shown before, scroll down and press the "Submit" button.</p></div>' +
                '<div style="display: block; position: static; background-color: #808080; '+
                'width: 800px; height: 300px;"><div style="position: relative; top: 50px"><img src="'+stimFolder+'gabor'+String(rot)+'.png" /></div></div>'

            return html
        }

        var reconstruction = {
            type: 'reconstruction',
            stim_function: updateRotation,
            starting_value: 0.5,
            step_size: 0.1,
            button_label: "Submit",
            // button_pos: function(){
            //     var whalf = window.innerWidth/2 || document.documentElement.clientWidth/2 || document.body.clientWidth/2;
            //     var h = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;
            //     return [(whalf-40), (h-100)]
            // },
        }

        var ifSeeProbe = {
            type: 'survey-html-form',
            html: letter_1(),
            data: {trial_category: "ifSeeProbe"+append}
        }
        var WhichLetter = {
            type: 'survey-html-form',
            html: letter_2(),
            data: {trial_category: "LetterTask_Which"+append}
        }

       var letterConfidence  = {
            type: 'survey-html-form',
            html: letter_confidence(),
            data: {trial_category: "confidence"+append}
        }

        var gaborConfidence  = {
            type: 'survey-html-form',
            html: gabor_confidence(),
            data: {trial_category: "confidence"+append}
        }

        timelineTrialsToPush.push(if_notFull);
        if (runVirtualChinrest == true){
            timelineTrialsToPush.push(virtualChin);
        }

        if (skipToTask == false) {
            timelineTrialsToPush.push(mug_intro)
            timelineTrialsToPush.push(cursor_off);
            timelineTrialsToPush.push(isi);
            timelineTrialsToPush.push(mugImgShow);
            timelineTrialsToPush.push(cursor_on);

            timelineTrialsToPush.push(mugTextResponse);
            timelineTrialsToPush.push(transitiontask1);
            timelineTrialsToPush.push(logoTask);
            timelineTrialsToPush.push(transitiontask2);
            // timelineTrialsToPush.push(captcha(benchImgPath,agentType,numOnTable,20,20,imgWidth,imgHeight, probe0ImgPath, probe1ImgPath, probe2ImgPath));
        }
        timelineTrialsToPush.push(captcha(benchImgPath,agentType,numOnTable,20,20,imgWidth,imgHeight, probe0ImgPath, probe1ImgPath, probe2ImgPath));

        timelineTrialsToPush.push(transitiontask3);
        timelineTrialsToPush.push(cursor_off);
        timelineTrialsToPush.push(fixation);
        timelineTrialsToPush.push(showProbe);
        timelineTrialsToPush.push(fixation);
        timelineTrialsToPush.push(cursor_on);

        if (probeType == 'letter'){
            timelineTrialsToPush.push(IfSeeProbe);
            timelineTrialsToPush.push(WhichLetter);
            timelineTrialsToPush.push(letter_confidence());
        } else if (probeType == 'gabor'){
            timelineTrialsToPush.push(ifSeeProbe);
            timelineTrialsToPush.push(reconstruction);
            timelineTrialsToPush.push(gaborConfidence);
        }

    } /* run single trial end */



    </script>
</body>
</html>

<!-- perceptionexperiments.net/KWW/ullObs/ullObs_04012022.html -->
