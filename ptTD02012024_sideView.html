<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ptTD Study</title>
    <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script> -->
    <script src="../jspsych-6.1.0/jspsych.js"></script>
    <!-- <script src="../jspsych-6.1.0/plugins/jspsych-instructions-delay.js"></script> -->
    <script src="../jspsych-6.1.0/plugins/jspsych-instructions-gray2.js"></script>
    <script src="../jspsych-6.1.0/plugins/jspsych-html-keyboard-response.js"></script>
    <script src="../jspsych-6.1.0/plugins/jspsych-image-keyboard-response.js"></script>
    <script src="../jspsych-6.1.0/plugins/jspsych-html-button-response.js"></script>
    <script src="../jspsych-6.1.0/plugins/jspsych-html-button-responseHTMLvert.js"></script>
    <script src="../jspsych-6.1.0/plugins/jspsych-html-button-response-hidden.js"></script>
    <script src="../jspsych-6.1.0/plugins/jspsych-html-slider-response.js"></script>
    <script src="../jspsych-6.1.0/plugins/jspsych-survey-html-form.js"></script>
    <script src="../jspsych-6.1.0/plugins/jspsych-survey-html-timer.js"></script>
    <script src="../jspsych-6.1.0/plugins/jspsych-fullscreenSOA.js"></script>
    <script src="../jspsych-6.1.0/plugins/jspsych-call-function.js"></script>
    <!-- <script src="../jspsych-6.1.0/plugins/jo-show-maze-trace-resp.js"></script> -->
    <script src="../jspsych-6.1.0/plugins/kw-show-click-adj.js"></script>
    <script src="../jspsych-6.1.0/plugins/jspsych-rdk2.js"></script>
    <script src="../jspsych-6.1.0/plugins/rw-html-slider-response.js"></script>
    <script src="../jspsych-6.1.0/plugins/jspsych-survey-text.js"></script>

    <!-- jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"
      integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU=" crossorigin="anonymous"></script>

    <!-- <link href = "../jspsych-6.1.0/css/jspsych-cpCD.css" rel="stylesheet" type="text/css"></link> -->
    <link href = "../jspsych-6.1.0/css/jspsych-ipCD_dynamicTflip.css" rel="stylesheet" type="text/css"></link>
</head>
<body>
    <script>

    // 02.20.2023 - took ullObs code and adapted it for pt study
    // 02.22.2023 - combining both Huichao instructions section with click module.
    // 09.04.2023 - new randomization method
    // 10.10.2023 - updated to match ptNL's new images and click-show
    // 10.16.2023 - ptTD formed.
    // 11.10.2023 - colorComp version, + making logos vertical
    // 02.01.2024 - adding a PRIMING task version
    // 02.04.2024 - changed instructions for colorComp version, and also have removed colorComp as this is side view with various new variables
    // NOTE TO KIM: NEED TO ADD ONE MORE QUESTION TO JUST ASK WHAT LETTER OR NUMBER THEY JUST SAW. AND THEN ADJUST ANALYSIS CODE.


    /*
    ===============================================================
    Table of Contents (*TOC)
    ===============================================================
    1. Core Variables (*coreV) -- bypass, constants, blanks
    2. Introduction Section (*timelineintro)
    3. Experiment Section (*timelineexpt)
    4. JSPsych Init, and onFinish (*initexpt)
    5. Critical functions (*fx)
    6. Code for each trial (*singleTrial)


    */

    /*
    ===============================================================
    Defining Core Variables (*coreV)
    ===============================================================
    */

    var stimFolder = 'stimuli_sideview/'

    var runIntro = true;
    var runInstr = true;
    var runExpt = true;
    var runSaveData = true;
    var runPriming = true;

    var showAllImages = true;

    var inanimateList = ['t'] // side view doesn't have trashcan version yet, just female
    // var imgWidth = 500
    // var imgHeight = 370
    // var imgWidth = 500*(1.2)
    // var imgHeight = 370*(1.2)
    var imgWidth = 1000*0.75
    var imgHeight = 740*0.75


    // var PREPROBE_DISP_TIME = 800
    // var COREPROBE_DISP_TIME = 650
    // var ALLPROBES_DISP_TIME = 2000
    var ISI_DURATION = 500



    var estTotalRunTime = 3
    var estDollars = 0.45


    var timelinebase = [];
    var forPreload = [];
    var full_check = false;

    //participant information extraction from URL
    var participantType = 'prolific'; // either 'mturk' or 'pOrolific'
    // var participantType = 'mturk';
    // var participantType = 'sona'
    var prolific_url = 'https://app.prolific.co/submissions/complete?cc=2D8B06CB';

    var w = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
    var h = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;
    console.log(w,h)
    var leftdistance = w/2-75;
    var text_color = 'black';

    var RADIUS = 250
    var HRADW = RADIUS*Math.cos(0.785398)
    var HRADH = RADIUS*Math.sin(0.785398)



    // capture URL query info (capture query)
    var code = jsPsych.randomization.randomID(10);

    if (participantType == 'mturk'){
        var workerID = getURLParameter('workerId');
        var hitID = getURLParameter('hitId');
        var assignmentID = getURLParameter('assignmentId');
        console.log(workerID, hitID, assignmentID);
    } else if (participantType == 'prolific'){
        var workerID = getURLParameter('PROLIFIC_PID');
        var hitID = getURLParameter('STUDY_ID');
        var assignmentID = getURLParameter('SESSION_ID');
        console.log(workerID, hitID, assignmentID);
    } else if (participantType == 'sona'){
        var workerID = getURLParameter('sona_id');
        var hitID = getURLParameter('testing_hitID');
        var assignmentID = getURLParameter('testing_assignmentID');
    } else {
        var workerID = 'testingworker_ID';
        var hitID = 'testing_hitID';
        var assignmentID = 'testing_assignmentID';
    };



    /*
    ===============================================================
    INTRO PROCEDURE (*timelineintro)
    ===============================================================
    */

    /*-------------- Relevant intro variables (*introVar/*varIntro)---------------------*/
    var welcome = {
        type: 'html-button-response',
        stimulus: "<div style='display: inline-block; margin: 0 auto; padding: 10px 200px 10px 200px; text-align: left'>"+
        '<p>Welcome to the experiment.</p><p>Please make sure you are completing the experiment on a COMPUTER OR LAPTOP. '+
        'You will <b>not</b> be able to complete this experiment on a phone or tablet. </p>'+'</div>',
        choices: ['Next'],
        on_finish: function(){
            if (/Mobi|Android/i.test(navigator.userAgent)) {
                console.log("Uh Oh, this is a mobile device");
                jsPsych.endExperiment("Oh no! It appears you're on a mobile/tablet device. Please try again on a computer or laptop.")
            }else{
                console.log("Good, not a mobile device.")
            }

            // console.log(w*2,h*2)
        },
        data: {trial_category: 'welcome',
                screenWidth: String(w),
                screenHeight: String(h),
                // radius: String(RADIUS),
                clock: function(){
                var startTime = new Date().toLocaleString("en-US", {timeZone: "America/New_York"});
                startTime = new Date(startTime);
                console.log('Start Time'+startTime.toLocaleString())
                return startTime
            }
        }
    };

    // consent form
    var consent = {
        type: 'html-keyboard-response',
        choices: ['y'],
        stimulus: consentForm(participantType),
        prompt: "<h3>PRESS THE Y KEY TO CONSENT</h3><p></p><p></p>",
        data: {trial_category: 'consent'}
    };


    var id = {
        type: 'survey-html-form',
        html: function(){
            var text = "<div style='display: inline-block; margin: 0 auto; padding: 10px 200px 10px 200px; text-align: left'>"
            if (participantType == 'sona'){
                var insert = "SONA Portal ID (not your Yale ID) -- this should be a 5 digit number with no letters"
            } else {
                var insert = participantType + " ID"
            }
            if (workerID == 'no_query'){
                text +="<p>Please provide your "+insert+":</p><br><input required='true' name='numberID' type='text' size='70' />"
                // text +="<p>Please provide your "+participantType+" ID:</p><br><input required='true' name='numberID' type='text' size='100' />"
            } else if (workerID != undefined){
                console.log(workerID)
                text +="<p>Please provide your "+insert+":</p><br><input required='true' name='numberID' type='text' value='"+String(workerID)+"' size='70' />"
                // text +="<p>Please provide your "+participantType+" ID:</p><br><input required='true' name='numberID' type='text' value="+String(workerID)+" size='100' />"
            } else {
                console.log("code is not working")
                text +="<p>Please provide your "+insert+":</p><br><input required='true' name='numberID' type='text' size='70' />"
                // text +="<p>Please provide your "+participantType+" ID:</p><br><input required='true' name='numberID' type='text' size='100' />"
            }
            text +="<p>(Note: Depending on the way you accessed this link, you may find that your ID is already entered into the box for your convenience, but please double check if this number is correct before proceeding.)</p>"
            text +="</div>"

            return text},
        data: {trial_category: 'id_info'},
        on_finish: function(data) {
            var respObj = JSON.parse(data.responses);
            for (var key in respObj) {
                if (respObj[key] == workerID){
                    console.log("The manual type matches the query capture, going with query input.");
                } else if (workerID == 'no_query'){
                    console.log("The query was not successfully captured, or there was nothing to query, going with manual input.");
                    workerID = respObj[key];
                } else {
                    console.log("The manual type differed from the query capture, going with query capture.")
                    workerID = respObj[key];
                }
            }  /*end of for loop*/
        } /*end of on_finish*/
    };

    var survey = {
        type: 'html-keyboard-response',
        stimulus: surveyForm(),
        choices: ['y'],
        data: {trial_category: 'survey'}
    }

    /* ------- timeline intro push (*pushIntro) -------------- */

    if (runIntro == true){
        timelinebase.push(welcome);
        timelinebase.push(consent);
        timelinebase.push(id);
        timelinebase.push({type: 'fullscreen',
                            fullscreen_mode: true,
                            on_finish: function(){
                                full_check = true;
                            }
                        });
        // timelinebase.push(survey);
    }/* if runIntro == true end */



    /*
    ===============================================================
    INSTR PROCEDURE (*timelineinstr)
    ===============================================================
    */

    var instrContent = loadInstrContent();

    if (runInstr == true){
        for (var slide = 0; slide < instrContent.length; slide++){
            var instruction_delay = {
                type: 'instructions',
                pages: [instrContent[slide]],
                allow_keys: false,
                allow_backward: false,
                show_clickable_nav: true,
                button_delay: 5000,
                data: {trial_category: 'instruction'}
            }

            timelinebase.push(instruction_delay)

        } /* for loop ends*/
    }/* if runInstr true end*/


    /*
    ===============================================================
    EXPERIMENT PROCEDURE (*timelineexpt)
    ===============================================================
    */

    /* -------- defining factors && exptdesign (*factors) --------*/
    var possAgent = ["f"];
    var possTableNum = ["letterD","letterP"];
    // var possColor = ["gd","gl"]
    var possColor = ["r","b"]
    var letterSharpness = 'sharp'

    var possRotate = [0];
    var possFlip = ['n','h'];
    // var possPrimeAligns = [false,true]
    var possPrimeAligns = [false]

    // var possSym = [1,2,3,4];
    var possSym = [1,2];




    /*new randomization method*/
    randAgentIndex = Math.floor(Math.random() * possAgent.length);
    randTableNumIndex = Math.floor(Math.random() * possTableNum.length);
    randColorIndex = Math.floor(Math.random() * possColor.length);

    var thisAgent = possAgent[randAgentIndex];
    var thisAnchNum = String(possTableNum[randTableNumIndex]);
    var thisColor = possColor[randColorIndex];

    // /* for two symbol version */
    // for (var k = 0; k < possSym.length; k++) {
    //     for (var l = 0; l < possColor.length; l++) {
    //         for (var m = 0; m < possColor.length; m++) {
    //             forPreload.push(stimFolder + thisAgent + "sym" + String(possSym[k]) + "_" + possColor[l] + "_" + possColor[m] + ".png");
    //         }
    //     }
    // }
    // for (var l = 0; l < possColor.length; l++) {
    //     for (var m = 0; m < possColor.length; m++) {
    //         forPreload.push(stimFolder + thisAgent + thisAnchNum + "_" + possColor[l] + "_" + possColor[m] + ".png");
    //     }
    // }

    /* for one symbol version 02.05.2024 */
    for (var k = 0; k < possSym.length; k++) {
        for (var l = 0; l < possColor.length; l++) {
            forPreload.push(stimFolder + thisAgent + "sym" + String(possSym[k]) + "_" + possColor[l] + ".png");
        }
    }
    for (var l = 0; l < possColor.length; l++) {
        forPreload.push(stimFolder + thisAgent + thisAnchNum + "_" + possColor[l] + ".png");
    }


    forPreload.push(stimFolder+"blank_f.png");
    // forPreload.push(stimFolder+"blank_t.png");
    forPreload.push(stimFolder+"logoY.png");
    forPreload.push(stimFolder+"logoS.png");
    if (runPriming == false){
        forPreload.push(stimFolder+"suitcase.png");
        // forPreload.push(stimFolder+"watch.png");
        // forPreload.push(stimFolder+"headphone.png");
    } else {
        forPreload.push(stimFolder+"noiseDemo.png");
        for (var z = 0; z < possTableNum.length; z++) {
            forPreload.push(stimFolder + "noise" + possTableNum[z] + "_" + letterSharpness + ".png");
        }
    }



    /* ------- timeline expt push (*pushExpt ) -------------- */
    if (runExpt == true){
        // for (var elem = 0; elem < full_design.length; elem++){ /* normally its elem < 1 for single trial */
        for (var elem = 0; elem < 1; elem++){ /* normally its elem < 1 for single trial */

            var thisRotate = jsPsych.randomization.sampleWithReplacement(possRotate, 1)[0];
            var thisFlip = jsPsych.randomization.sampleWithReplacement(possFlip, 1) [0];
            var thisPrimeAligns = jsPsych.randomization.sampleWithReplacement(possPrimeAligns, 1) [0];
            // var thisStim = full_design[elem].agent+String(full_design[elem].tableNum)
            if (runPriming == true){
                console.log(thisAgent, thisAnchNum, thisPrimeAligns)
                runSingleTrial(thisAgent, thisAnchNum, thisPrimeAligns, thisColor, showAllImages, timelinebase, 'expt')
            } else {
                runSingleTrial(thisAgent, thisAnchNum, "noPrimeToAlign", thisColor, showAllImages, timelinebase, 'expt')
            }
        }


    }


    /*
    ===============================================================
    CLOSING SECTION (*timelineclose)
    ===============================================================
    */

    // var debrief_qs = {
    //     type: 'survey-html-form',
    //     html: debriefForm(),
    //     data: {trial_category: 'debrief',
    //         clock: function(){
    //             var endTime = new Date().toLocaleString("en-US", {timeZone: "America/New_York"});
    //             endTime = new Date(endTime);
    //             console.log('End Time'+endTime.toLocaleString())
    //             return endTime
    //         }
    //     },
    //     on_finish: function(){
    //         var postdeb= jsPsych.data.get().filterCustom(function(trial){
    //             return trial.trial_category != "answer_instr";
    //         })
    //         // jsPsych.data.displayData('csv');
    //         var answerfiltered1 = jsPsych.data.get().filter({trial_category: "answer"})
    //         // console.log(answerfiltered.csv());
    //
    //         saveData(workerID+"postdeb_data", postdeb.csv())
    //         saveData(workerID+"answerfiltered1_data", answerfiltered1.csv());
    //     }
    // };


    var debrief_original = {
        type: 'survey-html-form',
        html: debriefForm(),
        data: {trial_category: 'debrief_original'}
    }

    var debrief_rememberAny={
        type: 'survey-text',
        questions:[
            // {prompt:"<div style='width: 70%; text-align: left; margin: 0 auto'>" +'</p>In the task where you had to click on blue rectangles, there were other things on the black table. In 1-2 sentences, please tell us anything you remember about what they were.</p>', required: true}
            // {prompt:"<div style='width: 70%; text-align: left; margin: 0 auto'>" +'</p>In the task where you had to click on white triangles, there were other things on the black table. In 1-2 sentences, please tell us anything you remember about what they were.</p>', required: true}
            // {prompt:"<div style='width: 70%; text-align: left; margin: 0 auto'>" +'</p>In the task where you had to determine the color of things, can you remember anything about what those red/blue things were? Please type down any things you remember.</p>', required: true}
            // {prompt:"<div style='width: 70%; text-align: left; margin: 0 auto'>" +'</p>In the task where you had to compare the color of the green things, can you remember anything about what those green things were? Please type down any things you remember.</p>', required: true}
            // {prompt:"<div style='width: 70%; text-align: left; margin: 0 auto'>" +'</p>In the task where you had to determine the color of the thing on the table, can you remember anything about what those things on the table were? Please type down any things you remember.</p>', required: true}
            {prompt:"<div style='width: 70%; text-align: left; margin: 0 auto'>" +'</p>In the task where you had to determine the color of the shape on the table, can you remember anything about what those shapes on the table were? Please type down any shapes you remember.</p>', required: true}

        ],
        data: {trial_category: 'debrief_rememberAny'}
    }

    // var debrief_rememberAny = {
    //     type: 'survey-html-form',
    //
    // }

    var debrief_confidence = {
        type: 'survey-html-form',
        html: debriefForm_confidence(runPriming),
        data: {trial_category: 'debrief_confidence',
            clock: function(){
                var endTime = new Date().toLocaleString("en-US", {timeZone: "America/New_York"});
                endTime = new Date(endTime);
                console.log('End Time'+endTime.toLocaleString())
                return endTime
            }
        },
        on_start: function () {
                    document.body.style.backgroundColor = 'white';
                    document.body.style.textColor = 'black';
                    document.body.style.overflow = 'scroll';
                },
        on_finish: function(){
            var full= jsPsych.data.get().filterCustom(function(trial){
                return trial.trial_category != "answer_instr";
            })
            // jsPsych.data.displayData('csv');
            var answerfiltered = jsPsych.data.get().filter({trial_category: "answer"})
            // var taskfiltered = jsPsych.data.get().filter({trial_category: "task", thispShow: "all"})
            var taskfiltered = jsPsych.data.get().filter({trial_category: "colorAnswer"})
            // console.log(answerfiltered.csv());

            if (runSaveData == true){
                saveData(workerID+"answerfiltered_data", answerfiltered.csv());
                saveData(workerID+"full_data", full.csv())
                saveData(workerID+"taskfiltered_data", taskfiltered.csv());

                var rand_code = hitID+String(code)+workerID;
                var saveRandCode = {
                    'savetocsv': 'workerCreditCodes', //filename to save the data with
                    'curData': workerID+','+hitID+','+assignmentID+','+rand_code// data to save
                    }
                myPostData('mySave.php', saveRandCode);
            } /*if runSaveData end*/
        }
    };

    // var closing = {
    //     type: 'html-keyboard-response',
    //     stimulus: closingText(participantType),
    //     choices: ['Spacebar'],
    //     data: {trial_category: 'closing'},
    //     on_start: function(){
    //         if (participantType == 'mturk'){
    //             jsPsych.endExperiment()
    //         } else if (participantType == 'prolific'){
    //             console.log("this is a prolific participant")
    //         }
    //     }, /* end of closing on start function */
    //     on_finish: function(){
    //         if (participantType == 'prolific'){
    //             window.open(prolific_url, '_blank')
    //         }
    //         jsPsych.endExperiment()
    //     }
    // };


    // new closing module
    var closing = {
        type: 'html-keyboard-response',
        stimulus: closingText(participantType),
        choices: ['Spacebar'],
        data: {trial_category: 'closing'},
        on_start: function(){
            if (participantType == 'mturk'){
                jsPsych.endExperiment()
            } else if (participantType == 'prolific'){
                console.log("this is a prolific participant")
            } else if (participantType == 'sona'){
                console.log("this is a sona")
            }
        },
        on_finish: function(){
            if (participantType == 'prolific'){
                window.open(prolific_url, '_blank')
            }
            jsPsych.endExperiment()
        } /* end of closing on finish function */
    };

    /* ------- timeline close push (*pushclose) -------------- */

    timelinebase.push(debrief_original);
    timelinebase.push(debrief_rememberAny);
    timelinebase.push(debrief_confidence);
    timelinebase.push({type: 'fullscreen', fullscreen_mode: false});
    timelinebase.push(closing);


    // four unique sets, four cloths per set, randomly shuffle position, two possible difftrial conditions

    /*
    ===============================================================
    JSPsych Init, and onFinish (*initexpt)
    ===============================================================
    */
    jsPsych.init({
        preload_images: forPreload,
        on_interaction_data_update: function(){
            var interaction_data = jsPsych.data.getInteractionData().last(1).values()[0].event;
            if (interaction_data == 'fullscreenexit'){
                console.log("Fullscreen Exit detected")
                full_check = false
            } else if (interaction_data == 'fullscreenenter') {
                console.log("Fullscreen problem now solved")
                full_check = true
            }
        },
        on_trial_finish: function(data){
            if (data.trial_category == 'answer' && runPriming == true){
                if (data.button_pressed = 76) {
                    data.thisAcc = 1;
                } else if (data.button_pressed = 78) {
                    data.thisAcc = 0;
                } else {
                    data.thisAcc = "Kim your letter keycodes are broken";
                }
            } /*if answer end*/
        }, /*on trial finish end*/
        on_finish: function() {
            var full = jsPsych.data.get().filterCustom(function(trial){
                return trial.trial_category != "answer_instr";
            })
            // jsPsych.data.displayData('csv');
            var answerfiltered = jsPsych.data.get().filter({trial_category: "answer"})
            // console.log(answerfiltered.csv());

            if (runSaveData == true){
                saveData(workerID+"answerfiltered_data", answerfiltered.csv());
                saveData(worker+"full_data", full.csv())

                var rand_code = hitID+String(code)+workerID;
                var saveRandCode = {
                    'savetocsv': 'workerCreditCodes', //filename to save the data with
                    'curData': workerID+','+hitID+','+assignmentID+','+rand_code// data to save
                    }
                myPostData('mySave.php', saveRandCode);
            }
        },
        timeline: timelinebase,
    })


    /*
    ===============================================================
    CRITICAL FUNCTIONS (*fx)
    ===============================================================
    */


    /* ----------------------------------------
     Functions for text: instructions, debrief, consent, and id form entry (*fxtext)
    -------------------------------------------*/
    function loadInstrContent() {
        var instrContent = [
            /* ind0 */'<p>Hello! Thank you for volunteering to help out with our study. Please take a moment to adjust your seating so that you can comfortably watch the monitor and use the keyboard. Feel free to dim the lights as well.</p><p>Close the door or do whatever is necessary to <b>minimize disturbance during the experiment</b>. Please also take a moment to silence your phone so that you are not interrupted by any messages mid-experiment. Do <i>not</i> switch to any other tabs or windows until you are complete.</p><p>From here on out, you will notice the arrow to continue to the next page is initially grayed out, unable to be pressed. Just wait a short while and then you will be able to proceed.</p>',
            /* ind1 */'<p>In this experiment, you will be completing a bunch of different tasks in quick succession.</p><p>In the initial task (starting on the next page) you will see many moving dots. There is a lot of different movement, but the <b>majority of the dots</b> will be moving either <i>left or right</i>. You should <b>press the left or right arrow on your keyboard</b> to report whether more dots are moving to the left or to the right. (The dots will not stop moving until you press the left or right arrow) </p><p>When you are ready, press the "Next" button to do this <b>multiple times</>.</p>',
        ]
        for (var i = 0; i < instrContent.length; i++){
            instrContent[i] = "<div style='display: inline-block; margin: 0 auto; padding: 10px 200px 10px 200px; text-align: left'>"+instrContent[i]+"</div>"
        }
        return instrContent
    }


    function consentForm(participantType){
        if (participantType == 'sona'){
            var consentContent = "<h5>USE ARROW KEYS TO SCROLL DOWN, AND PRESS 'Y' TO CONSENT.<br>In order to run this study, we need to include the standard consent form below.</h5><h1>Consent for Participation in a Research Study</h1><div style='width: 100%; text-align: center'><div style='display: inline-block; margin: 0 auto; padding: 10px 200px 10px 200px; text-align: left'><h5>STUDY TITLE</h5><p>Testing reaction time and your judgement abilities</p>"+
            "<h5>RESEARCH STUDY SUMMARY, RISKS, AND BENEFITS</h5><p>Thank you for volunteering to participate in this research study. The purpose of this study is to better understand how we see and how we think. Study activities will include examining simple displays and then responding by answering questions, pressing some keys, or using a computer mouse. Because these are activities that many people already experience hundreds or thousands of times every day, there are no risks involved in this study. The study may have no benefits to you, but it may help the scientific community come to better understand how the human mind works. Taking part in this study is your choice. You can choose to take part, or you can choose not to take part in this study. You can also change your mind at any time, with no penalty.</p><h5>DURATION</h5><p>If you agree to take part, the study will last approximately <strong> "+String(estTotalRunTime)+" minutes</strong>.</p>"+
            "<h5>COSTS AND COMPENSATION</h5><p>There are no costs associated with participation in this study. You will receive <strong>"+String(0.5)+" credits</strong> for participating.</p><h5>CONFIDENTIALITY</h5><p>No personally identifying information will be collected, so your participation will be anonymous. The survey is anonymous. We will not know your name. We will not be able to connect any identifying information to your survey answers. However, we will know your mTurk number in order to pay you for your time. We will keep the information about your participation in this research confidential. Your data will be pooled with those from other participants, and may be included in scientific publications and uploaded to public data repositories.</p>"+
            "<h5>LEARNING MORE</h5><p>If you have questions about this study, you may contact your experimenters Kimberly Wong at kimberly.wong@yale.edu or Huichao Ji at huichao.ji@yale.edu. If you have questions about your rights as a research participant, or you have complaints about this research, you can contact the Yale Institutional Review Boards at 203-785-4688 or hrpp@yale.edu.</p><h5>INFORMED CONSENT</h5><p>Your participation indicates that you have read and understood this consent form and the information presented and that you agree to be in this study.</p></div></div>"
        } else {
            var consentContent = "<h5>USE ARROW KEYS TO SCROLL DOWN, AND PRESS 'Y' TO CONSENT.<br>In order to run this study, we need to include the standard consent form below.</h5><h1>Consent for Participation in a Research Study</h1><div style='width: 100%; text-align: center'><div style='display: inline-block; margin: 0 auto; padding: 10px 200px 10px 200px; text-align: left'><h5>STUDY TITLE</h5><p>Testing reaction time and your judgement abilities</p>"+
            "<h5>RESEARCH STUDY SUMMARY, RISKS, AND BENEFITS</h5><p>Thank you for volunteering to participate in this research study. The purpose of this study is to better understand how we see and how we think. Study activities will include examining simple displays and then responding by answering questions, pressing some keys, or using a computer mouse. Because these are activities that many people already experience hundreds or thousands of times every day, there are no risks involved in this study. The study may have no benefits to you, but it may help the scientific community come to better understand how the human mind works. Taking part in this study is your choice. You can choose to take part, or you can choose not to take part in this study. You can also change your mind at any time, with no penalty.</p><h5>DURATION</h5><p>If you agree to take part, the study will last approximately <strong> "+String(estTotalRunTime)+" minutes</strong>.</p>"+
            "<h5>COSTS AND COMPENSATION</h5><p>There are no costs associated with participation in this study. You will receive <strong>"+String(estDollars)+" dollars</strong> for participating.</p><h5>CONFIDENTIALITY</h5><p>No personally identifying information will be collected, so your participation will be anonymous. The survey is anonymous. We will not know your name. We will not be able to connect any identifying information to your survey answers. However, (if you are accessing this experiment through mTurk), we will know your mTurk number in order to pay you for your time. Your mTurk number could possibly be connected to your public profile, which could, in theory, be searched. We want to stress that we will not be looking at anyone's public profiles. We will keep the information about your participation in this research confidential. Your data will be pooled with those from other participants, and may be included in scientific publications and uploaded to public data repositories.</p>"+
            "<h5>LEARNING MORE</h5><p>If you have questions about this study, you may contact your experimenters Kimberly Wong at kimberly.wong@yale.edu or Huichao Ji at huichao.ji@yale.edu. If you have questions about your rights as a research participant, or you have complaints about this research, you can contact the Yale Institutional Review Boards at 203-785-4688 or hrpp@yale.edu.</p><h5>INFORMED CONSENT</h5><p>Your participation indicates that you have read and understood this consent form and the information presented and that you agree to be in this study.</p></div></div>"
        }
        return consentContent
    }

    function surveyForm(){
        var surveyContent =
            "<div style='width: 100%; text-align: center'><div style='display: inline-block; margin: 0 auto; padding: 10px 200px 10px 200px; text-align: left'>"+
            "<p>We wanted to provide a heads-up that the end of the experiment will consist of an anonymous survey with multiple questions. "+
            "A few questions are open-ended questions where you need to type 1-2 sentences. Sometimes participants do not like answering open-ended questions and tend to quit a survey once they see such questions. "+
            "If a sizable number of people quit a survey halfway, the responses will no longer be useful. Our research depends on good quality responses. Thus, please make sure you do not mind open-ended questions before continuing with experiment.</p>"+
            "<p><i>Press 'y' on your keyboard if you agree to answer the open-ended questions at the end of the experiment.</i><br>"+
            "</div>"
        return surveyContent
    }

    function debriefForm(){
        var debriefContent = "<div style='width: 50%; text-align: left; margin: 0 auto'>" +
        '<p>Great work. Finally, we just have a couple of questions for you!<br>' +
        '<p>Age: <br><input required="true" name="age" type="number" style="width: 20%; border-radius: 4px; padding: 10px 10px; margin: 8px 0; border: 1px solid #ccc; font-size: 15px"/>' +
        '<p>Please indicate your biological sex:<br><input required="true" type="radio" id="male" name="gender" value="male"><label for="male">Male</label><br><input required="true" type="radio" id="female" name="gender" value="female"><label for="female">Female</label><br><input required="true" type="radio" id="other" name="gender" value="other"><label for="other">Other</label><br><input required="true" type="radio" id="no_say" name="gender" value="no_say"><label for="no_say">I prefer not to say</label>' +
        '<p>Anything else to share (did any of the images get cut off on your screen, or just additional thoughts, etc.)? <br><input required="true" name="6_final" type="text" size="50" style="width: 100%; border-radius: 4px; padding: 10px 10px; margin: 8px 0; border: 1px solid #ccc; font-size: 15px"/></p>' +
        // '<p>We know it is generally difficult to stay focused in these online experiments, especially when they take this long.  On a scale of 1-100 (with 1 being very distracted, and 100 being very focused), how well did you pay attention to the experiment?  (Whatever you respond with will NOT affect whether you receive credit or compensation). <br><input required="true" name="6_attention" type="number" max="100" style="width: 20%; border-radius: 4px; padding: 10px 10px; margin: 8px 0; border: 1px solid #ccc; font-size: 15px"></p>' +
        // '<p>Please reenter your ID once more:<br><input required="true" name="id_code" type="text" style="width: 20%; border-radius: 4px; padding: 10px 10px; margin: 8px 0; border: 1px solid #ccc; font-size: 15px"/>' +
        // '<p>Worker ID Code:<br><input required="true" name="id_code" type="text" style="width: 20%; border-radius: 4px; padding: 10px 10px; margin: 8px 0; border: 1px solid #ccc; font-size: 15px"/>' +
        "</div>"
        return debriefContent
    };

    function debriefForm_confidence(runPriming) {
        if (runPriming == true) {
            var debriefContent_confidence =
                "<div style='width: 50%; text-align: left; margin: 0 auto'>" +
                '<p>In fact, one of the shapes on the table was a letter. Do you remember what that letter was? Type in your best guess, and even if you don’t remember, just guess.<br><input name="tableNumGuess" type="text" size="50" style="width: 100%; border-radius: 4px; padding: 10px 10px; margin: 8px 0; border: 1px solid #ccc; font-size: 15px" required>' +
                '<p>Using the slider below, on a scale of 1-100 (with 1 being not confident at all, and 100 being very confident), how confident are you about the letter you just typed above?  (This will not affect whether you receive credit or compensation.) <br> <p style="text-align:left;">Not confident at all <span style="float:right;">Very Confident</span></p> <input type="range" value="50" min="1" max="100" name = "confidence" class="slider" style="width:100%" required oninput="this.nextElementSibling.value = this.value"> <output id = "confidence_out"  style="text-align:center">_</output> </p>' +
                "</div>"
        } else {
            var debriefContent_confidence =
                "<div style='width: 50%; text-align: left; margin: 0 auto'>" +
                '<p>In fact, one of the things on the table was a number. Do you remember what that number was? Type in your best guess, and even if you don’t remember, just guess.<br><input name="tableNumGuess" type="number" size="50" style="width: 100%; border-radius: 4px; padding: 10px 10px; margin: 8px 0; border: 1px solid #ccc; font-size: 15px" required>' +
                '<p>Using the slider below, on a scale of 1-100 (with 1 being not confident at all, and 100 being very confident), how confident are you about the number you just typed above?  (This will not affect whether you receive credit or compensation.) <br> <p style="text-align:left;">Not confident at all <span style="float:right;">Very Confident</span></p> <input type="range" value="50" min="1" max="100" name = "confidence" class="slider" style="width:100%" required oninput="this.nextElementSibling.value = this.value"> <output id = "confidence_out"  style="text-align:center">_</output> </p>' +
                "</div>"
        }
        return debriefContent_confidence
    };

    function closingText(participantType){
        var base = "Thank you so much for your contribution to science! The experiment has concluded. Please contact huichao.ji@yale.edu if you have any further questions.";
        var addition = "";
        if (participantType == 'mturk'){
            var rand_code = hitID+String(code)+workerID;
            var addition = "<p>Here is your <b>unique</b> code: "+rand_code+"</p><p>To recieve payment for this experiment, you must take this code back to the page that directed you here. Enter the code into the box there. If you encounter problems during this step, please contact the email above.";
        } else if (participantType == 'prolific'){
            var addition = "<p>For your convenience, you will find your completion code in a new tab <b>after you press the Spacebar</b>. Alternatively, here is the code for you to enter manually: <b>2D8B06CB</b>. If you encounter any problems during this step, please contact the email above."
        } else if (participantType == 'sona'){
            var addition = "<p>If you're interested in learning more about this experiment, please see the following google doc, and do not hesitate to reach out! Thank you for participating.</p><p>https://docs.google.com/document/d/1WxqXB8pD6Fv7XpP7IS3HsYDqlxJ-yT4M/edit?usp=sharing&ouid=109087269691106150998&rtpof=true&sd=true</p>"
        }
        return base+addition
    };


    /* ----------------------------------------
     Functions for datahandling and saving (*fxdata, *fxsave)
    -------------------------------------------*/

    function getURLParameter(sParam){
        var sPageURL = window.location.search.substring(1);
        var sURLVariables = sPageURL.split('&');
        for (var i = 0; i < sURLVariables.length; i++){
            var sParameterName = sURLVariables[i].split('=');
            if (sParameterName[0] == sParam){
                return sParameterName[1];
            }
        }
        console.log("The input was not found")
        return 'no_query'
    };

    function myPostData(page,data){
        $.ajax({
            type: "POST",
            url: page,
            data: data,
        });
    }

    function saveData(name, data){
        var xhr = new XMLHttpRequest();
        xhr.open('POST', 'write_data.php'); // 'write_data.php' is the path to the php file described above.
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.send(JSON.stringify({filename: name, filedata: data}));
    };



    /*
    ===============================================================
    PUSHING/RUNNING A CUSTOM SINGLE TRIAL (*singleTrial)
    ===============================================================
    */


    function runSingleTrial(thisAgent, thisAnchNum, thisPrimeAligns, randColor, showAchImg, timelineTrialsToPush, trialType){
        // different trialType modifiers
        if (trialType == 'instr' || trialType == 'instr_nocross' || trialType == 'instr_nomask'){
            var append = '_instr'
            // var preobj = 'prac'
        } else if (trialType == 'prac' || trialType == 'stair'){
            var append = '_prac'
            // var preobj = 'prac'
        } else {
            var append = ''
            // var preobj = ''
        }

        var checkScreen = {
            type: "fullscreen",
            message: "<p>Unfortunately, it appears you have turned off fullscreen mode. Please make sure to remain in fullscreen mode. <br>Click on the button to fullscreen the experiment again and proceed.</p>",
            fullscreen_mode: true,
            button_label: "Resume",
        }

        var if_notFull = {
            timeline: [checkScreen],
            conditional_function: function(){
                if (full_check == false){
                    return true;
                } else {
                    return false
                }
            }
        }

        var cursor_off = {
            type: 'call-function',
            func: function() {
                document.body.style.cursor= "none";
            }
        }

        var cursor_on = {
            type: 'call-function',
            func: function() {
                document.body.style.cursor= "auto";
            }
        }

        var setDotTask = function(correctDir) {
            var dotTask = {
                type: "rdk",
                number_of_dots: 400,
                RDK_type: 3,
                aperture_type: 4,
                aperture_width: screen.width / 2,
                aperture_height: screen.height / 2,
                aperture_center_x: screen.width / 2,
                aperture_center_y: screen.height / 2,
                move_distance: 2,
                choices: ["Leftarrow", "Rightarrow"],
                correct_choice: correctDir,
                coherent_direction: 180,
                coherence: 0.3,
                opposite_coherence: 0.2,
                dot_radius: 3,
                dot_color: "black",
                background_color: "white",
                trial_duration: 60000,
                data: {trial_category: "dotTask" + append},
            }
            return dotTask
        }

        var logoTask = {
            type: "html-button-response-vert",
            stimulus: "Click on the logo that you think would be better for this company that wants to appear 'organized and professional'.",
            choices: function(){
                var afcimgWidth = 200;
                var stimContent = []
                stimContent.push("<img src='"+stimFolder+"logoY.png' width='"+String(afcimgWidth)+"' />");
                stimContent.push("<img src='"+stimFolder+"logoS.png' width='"+String(afcimgWidth)+"' />");
                return stimContent
            },
            data: {trial_category: "logoTask"+append} // data end
        } // logoTask

        // var promptContent = "<div style='position: absolute; left:"+String(30)+"px ; top:"+String(h*2+30)+"px' >'f' = no ; 'j' = yes</div>";
        // var promptContent = "<div>Can you get from the red to the blue?'<br><b>f</b>' = no ; '<b>j</b>' = yes</div>";
        // var benchImgPath = stimFolder + benchImg + ".png";
        // var probe0ImgPath = stimFolder + "probe0v4.png";
        // var probe1ImgPath = stimFolder + "probe1v4.png";
        // var probe2ImgPath = stimFolder + "probe2v4.png";

        // var captcha = function(benchImgPath, left, top, imgWidth, imgHeight, probe0ImgPath, probe1ImgPath, probe2ImgPath){
        //     var clickResponse = {
        //         type: 'kw-show-click',
        //         image_path: benchImgPath,
        //         left: left,
        //         top: top,
        //         image_w: imgWidth,
        //         image_h: imgHeight,
        //         probe0_path: probe0ImgPath,
        //         probe1_path: probe1ImgPath,
        //         probe2_path: probe2ImgPath,
        //         probe_posX: [135, 288, 330],
        //         probe_posY: [263, 304, 236],
        //         probe_widths: [88, 65, 64],
        //         probe_heights: [42, 36, 33],
        //         show_probes: false,
        //         data: {trial_category: "clickResponse"+trialType}
        //     }
        //     return clickResponse
        // }
        var color = function(thisAgent, displayPng, thisColorDown, thisColorUp, location, imgWidth, imgHeight){
            var colorButton = {
                type: 'html-button-response',
                stimulus: function(){
                    if (thisColorUp != 0) {
                        var imgPath = stimFolder + displayPng + "_" + thisColorDown + "_" + thisColorUp + ".png"
                    } else {
                        console.log("enter")
                        var imgPath = stimFolder + displayPng + "_" + thisColorDown + ".png"
                    }
                    // console.log(imgPath)
                    var stimContent = "<img src='"+imgPath+"' width='"+String(imgWidth)+"' height='"+String(imgHeight)+"' />"
                    // var stimContent = "test"

                    if (inanimateList.includes(thisAgent)){
                        var topobj = "the trashcan"
                    } else {
                        var topobj = "the jacket"
                    }

                    if (location == "u"){
                        var locationtext = topobj
                        var otherlocation = "the table"
                    } else {
                        var locationtext = "the table"
                        var otherlocation = topobj
                    }

                    var sentence = "<p>Reminder: Is the shape on " + locationtext + " more red or more blue?</p>"
                    // var sentence = "<p>Is the thing on <b>" + locationtext + "</b> darker or lighter than "+ otherlocation +"?</p>"
                    // return divWrap + stimContent + "</div>" + sentence
                    return sentence + stimContent
                },
                // choices: ["Darker","Lighter"],
                choices: ["Red","Blue"],
                data: {trial_category: "colorAnswer"+append,
                    image_shown: displayPng,
                    image_w: imgWidth,
                    image_h: imgHeight,
                    thisAgent: thisAgent,
                    thisAnchNum: thisAnchNum,
                },
            }
            return colorButton
        }
        var isi = function(thisAgent, displayPng, thisColorDown, thisColorUp, thisBlank, imgWidth, imgHeight){
            var isiScreen = {
                type: 'html-button-response-hidden',
                stimulus: function(){
                    if (thisBlank == true) {
                        var imgPath = stimFolder + "blank_" + thisAgent + ".png"
                    } else {
                        if (thisColorUp != 0) {
                            var imgPath = stimFolder + displayPng + "_" + thisColorDown + "_" + thisColorUp + ".png"
                        } else {
                            var imgPath = stimFolder + displayPng + "_" + thisColorDown + ".png"
                        }
                    }
                    var stimContent = "<img src='"+imgPath+"' width='"+String(imgWidth)+"' height='"+String(imgHeight)+"' />"
                    // var stimContent = "test"
                    var sentence = "<p style='color: white'>loading...</p>"
                    // return divWrap + stimContent + "</div>" + sentence
                    return sentence + stimContent
                },
                // choices: ['Darker','Lighter'],
                choices: ["Red", "Blue"],
                trial_duration: function() {
                    if (thisBlank == true) {
                        return 500
                    } else {
                        return 2000
                        // return 3000
                    }
                },
                data: {trial_category: "isiScreen"+append,
                    image_shown: "blank_"+thisAgent,
                    image_w: imgWidth,
                    image_h: imgHeight
                }
            }
            return isiScreen
        }

        var transitiontask1 = {
            type: 'instructions',
            pages: function(){
                var text = "<p>Great! Now for the next task. On the next page, you will see some potential logos for a new company. Use your mouse and click on which logo you think would be better for the company, given that the company hopes to come across as 'organized and professional'.</p><p>When you are ready, press the button below to see the images.</p>"
                return [text]
            },
            allow_keys: false,
            allow_backward: false,
            show_clickable_nav: true,
            button_delay: 5000,
            data: {trial_category: 'transition1'}
        }

        var transitiontask2 = {
            type: 'instructions',
            pages: function(){
                /* for single object */
                var text = "<p>Good job! Now for the next task. Starting on the next page, you will see a series of images appear on screen. </p><p>On every image, there is going to be a table with a shape on it.  This shape on the table will be very pale in color, but it will be either slightly more <b>red</b> or more <b>blue</b>.</p><p>Your task is straightforward: Use the buttons below each image to report whether the shape on the table is more red or more blue. This task <i>will not necessarily be easy</i>, because the shape will be <i>very lightly tinted</i> in color.<p>When you are ready, press the button below to begin.</p>"

                /* for double object */
                // if (inanimateList.includes(thisAgent)) {
                //     var up = "trashcan"
                // } else {
                //     var up = "jacket"
                // }
                // var text = "<p>Good job! Now for the next task. Starting on the next page, you will see a series of images of a room.</p><p>On every image, there is going to be two <i style='color: green'>green</i> things: one on the table, and one on the "+up+".  Additionally, after the image appears, there will be a <i>short delay before a question appears</i>: you will be asked to compare the shades of the two green things. For example, you may be asked: 'Is the green thing on the table <b>darker</b> than the green thing on the "+up+"?' </p><p>This task <i>will not be easy</i>, because the things will be <i>only very slightly different</i> in their shades of green, and <u><b>each trial can be different</b>: you could be asked about <b>either</b> the thing on the table or the thing on the "+up+"</u>. So pay close attention to the instructions every time they appear! <p>When you are ready, press the button below to begin.</p>"

                return [text]
            },
            allow_keys: false,
            allow_backward: false,
            show_clickable_nav: true,
            button_delay: 5000,
            data: {trial_category: 'transition2'}
        }

        var rain_water = {
            type: 'survey-html-form',
            preamble: '<p>Good job! Now onto the next task.</p><p>Please answer the following question <b>without looking up the answer</b>, since we are interested in your intuitive <i>guess</i>: </p><p>How many <u>days of rain</u> do you think that the town of Dubuque, Iowa gets on average per year?</p>',
            html: '<p><input type="number" id="rain_water" name="response" size="10" /> days of rain</p>',
            autofocus: 'rain_water',
            // data: {trial_category:"anchor_suitcase"}
            data: {trial_category:"answer"+append,
                thisAgent: thisAgent,
                thisAnchNum: thisAnchNum}
        }

        var primingtransitiontask = {
            type: 'html-keyboard-response',
            stimulus: function(){
                var text = "<p>Great! Now onto the next task.</p><p>On the next page, you will see a messy/complicated image with a blurry letter or number hidden in the background. Your job is to determine, as quickly as possible, whether the hidden blurry background figure is a number or a letter. If it is a number, you'll press 'N'; if it is a letter, you'll press 'L'. (Do not worry about the capitalization.)</p> <p>Please put a finger on each of these keys now so that you are ready to respond as quickly as possible. When you're ready, press the Spacebar to make the image appear!</p>"
                // var noise = "<img src='" + stimFolder + "noiseDemo.png' width='" + String(imgWidth-80) + "' />"
                return text
            },
            choices: ['Spacebar'],
            data: {trial_category: 'transition_priming'}
        }

        // console.log(thisAnchNum);
        if (thisPrimeAligns == true) {
            var noiseLetter = thisAnchNum
        } else {
            if (thisAnchNum == 'letterD') {
                var noiseLetter = 'letterP'
            } else if (thisAnchNum == 'letterP') {
                var noiseLetter = 'letterD'
            } else if (thisAnchNum == 'letterU') {
                var noiseLetter = 'letterN'
            } else if (thisAnchNum == 'letterN') {
                var noiseLetter = 'letterU'
            }
        }
        // console.log(noiseLetter);

        var primedResponse = {
            type: 'html-keyboard-response',
            stimulus: function(){
                var text = "<p>N = number | L = letter</p>"
                var prime = "<img src='" + stimFolder + "noise" + noiseLetter + "_" + letterSharpness + ".png' width='" + String(imgWidth*(3/4)) + "' />"
                return text + prime
            },
            choices: ["n","l"],
            data: {trial_category: "answer"+append,
                image_w: imgWidth,
                image_h: imgHeight,
                thisAgent: thisAgent,
                thisPrimedLetter: thisAnchNum,
                thisPrimeAligns: thisPrimeAligns,
                thisNoiseLetter: noiseLetter,
            },
        }


        function shuffle(array) {
            let currentIndex = array.length, randomIndex;
            while (currentIndex > 0){
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]]
            }
            return array
        }

        /* for all versions regardless of number of symbols on table + jacket or whatever */
        var possSymbols = ["sym1","sym2"];
        var randDotAns = ["Leftarrow", "Rightarrow", "Leftarrow", "Rightarrow"]
        //
        // /* only for two symbol version*/
        // var possRandColors1 = ["r","r","b","b"];
        // // var possRandColors1 = ["gl","gd","gl","gd"];
        // var possRandColors2 = []
        // var possRandLocation = ["u","u","d","d"];
        // shuffle(possRandColors1);
        // shuffle(possRandLocation);
        // shuffle(randDotAns);
        // for (var c = 0; c < possRandColors1.length; c++) {
        //     if (possRandColors1[c] == "r"){
        //         possRandColors2.push("b")
        //     } else if (possRandColors1[c] == "b"){
        //         possRandColors2.push("r")
        //     } else if (possRandColors1[c] == "gl"){
        //         possRandColors2.push("gd")
        //     } else if (possRandColors1[c] == "gd"){
        //         possRandColors2.push("gl")
        //     } else {
        //         possRandColors2.push("possRandColors2broken")
        //     }
        // }
        // if (randColor == "r"){
        //     var counterColor = "b"
        // } else if (randColor == "b"){
        //     var counterColor = "r"
        // } else if (randColor == "gl"){
        //     var counterColor = "gd"
        // } else if (randColor == "gd") {
        //     var counterColor = "gl"
        // } else {
        //     var counterColor = "counterColor broken"
        // }


        /* one symbol version*/
        var possRandLocation = [0,0,0,0]
        var counterColor = 0
        var possRandColors1 = shuffle(["r","b"])
        if (randColor == "r"){
            possRandColors1.push("b")
        } else if (randColor == "b"){
            possRandColors1.push("r")
        } else {
            possRandColors1.push("BROKEN FINAL COLOR")
        }
        var possRandColors2 = []
        for (var c = 0; c < possRandColors1.length; c++) {
            possRandColors2.push(0)
        }



        timelineTrialsToPush.push(if_notFull);
        timelineTrialsToPush.push(setDotTask(randDotAns[0]));
        timelineTrialsToPush.push(setDotTask(randDotAns[1]));
        timelineTrialsToPush.push(setDotTask(randDotAns[2]));
        timelineTrialsToPush.push(transitiontask1);
        timelineTrialsToPush.push(logoTask);
        timelineTrialsToPush.push(transitiontask2);
        // timelineTrialsToPush.push(captcha(benchImgPath,20,20,imgWidth,imgHeight, probe0ImgPath, probe1ImgPath));
        //timelineTrialsToPush.push(captcha(benchImgPath,20,20,imgWidth,imgHeight, probe0ImgPath, probe1ImgPath, probe2ImgPath));
        // timelineTrialsToPush.push(captcha(benchImgPath,20,20,imgWidth,imgHeight, probe0ImgPath, probe1ImgPath, probe2ImgPath));

        if (showAllImages == true){
            for (var sym = 0; sym < possSymbols.length; sym++) {
                // timelineTrialsToPush.push(isi(thisAgent, thisAgent+possSymbols[sym], possRandColors1[sym], possRandColors2[sym], false, imgWidth, imgHeight))
                timelineTrialsToPush.push(color(thisAgent, thisAgent+possSymbols[sym], possRandColors1[sym], possRandColors2[sym], possRandLocation[sym], imgWidth, imgHeight));
                if (sym != possSymbols.length) {
                    timelineTrialsToPush.push(isi(thisAgent, thisAgent+possSymbols[sym], possRandColors1[sym], possRandColors2[sym], true, imgWidth, imgHeight))
                }
            }
        }
        var mainImg = thisAgent + thisAnchNum
        // timelineTrialsToPush.push(isi(thisAgent, mainImg, randColor, counterColor, false, imgWidth, imgHeight))
        timelineTrialsToPush.push(color(thisAgent, mainImg, randColor, counterColor, "d", imgWidth, imgHeight));
        if (runPriming == true){
            timelineTrialsToPush.push(primingtransitiontask);
            timelineTrialsToPush.push(primedResponse);
        } else {
           timelineTrialsToPush.push(rain_water);
        }
    } /* run single trial end */

    </script>
</body>
</html>

<!-- http://perceptionexperiments.net/KWW/ptAnch/ptTD02012024_sideView.html -->
